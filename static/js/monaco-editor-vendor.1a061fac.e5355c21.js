"use strict";(self.webpackChunk_uiw_react_monacoeditor=self.webpackChunk_uiw_react_monacoeditor||[]).push([[27],{31809:function(e,t,n){n.d(t,{v:function(){return l}});var i=n(37762),r=n(15671),s=n(43144),a=n(26684),o=n(10849),u=n(34725),l=function(){function e(t,n,i,s){(0,r.Z)(this,e),this._uri=t,this._lines=n,this._eol=i,this._versionId=s,this._lineStarts=null,this._cachedTextValue=null}return(0,s.Z)(e,[{key:"dispose",value:function(){this._lines.length=0}},{key:"version",get:function(){return this._versionId}},{key:"getText",value:function(){return null===this._cachedTextValue&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}},{key:"onEvents",value:function(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);var t,n=e.changes,r=(0,i.Z)(n);try{for(r.s();!(t=r.n()).done;){var s=t.value;this._acceptDeleteRange(s.range),this._acceptInsertText(new o.L(s.range.startLineNumber,s.range.startColumn),s.text)}}catch(a){r.e(a)}finally{r.f()}this._versionId=e.versionId,this._cachedTextValue=null}},{key:"_ensureLineStarts",value:function(){if(!this._lineStarts){for(var e=this._eol.length,t=this._lines.length,n=new Uint32Array(t),i=0;i<t;i++)n[i]=this._lines[i].length+e;this._lineStarts=new u.oQ(n)}}},{key:"_setLineText",value:function(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}},{key:"_acceptDeleteRange",value:function(e){if(e.startLineNumber!==e.endLineNumber)this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber);else{if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1))}}},{key:"_acceptInsertText",value:function(e,t){if(0!==t.length){var n=(0,a.uq)(t);if(1!==n.length){n[n.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]);for(var i=new Uint32Array(n.length-1),r=1;r<n.length;r++)this._lines.splice(e.lineNumber+r-1,0,n[r]),i[r-1]=n[r].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,i)}else this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]+this._lines[e.lineNumber-1].substring(e.column-1))}}}]),e}()},34725:function(e,t,n){n.d(t,{Ck:function(){return u},oQ:function(){return o}});var i=n(15671),r=n(43144),s=n(71881),a=n(60309),o=function(){function e(t){(0,i.Z)(this,e),this.values=t,this.prefixSum=new Uint32Array(t.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}return(0,r.Z)(e,[{key:"insertValues",value:function(e,t){e=(0,a.A)(e);var n=this.values,i=this.prefixSum,r=t.length;return 0!==r&&(this.values=new Uint32Array(n.length+r),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e),e+r),this.values.set(t,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(i.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}},{key:"setValue",value:function(e,t){return e=(0,a.A)(e),t=(0,a.A)(t),this.values[e]!==t&&(this.values[e]=t,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}},{key:"removeValues",value:function(e,t){e=(0,a.A)(e),t=(0,a.A)(t);var n=this.values,i=this.prefixSum;if(e>=n.length)return!1;var r=n.length-e;return t>=r&&(t=r),0!==t&&(this.values=new Uint32Array(n.length-t),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e+t),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(i.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}},{key:"getTotalSum",value:function(){return 0===this.values.length?0:this._getPrefixSum(this.values.length-1)}},{key:"getPrefixSum",value:function(e){return e<0?0:(e=(0,a.A)(e),this._getPrefixSum(e))}},{key:"_getPrefixSum",value:function(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];var t=this.prefixSumValidIndex[0]+1;0===t&&(this.prefixSum[0]=this.values[0],t++),e>=this.values.length&&(e=this.values.length-1);for(var n=t;n<=e;n++)this.prefixSum[n]=this.prefixSum[n-1]+this.values[n];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}},{key:"getIndexOf",value:function(e){e=Math.floor(e),this.getTotalSum();for(var t=0,n=this.values.length-1,i=0,r=0,s=0;t<=n;)if(i=t+(n-t)/2|0,e<(s=(r=this.prefixSum[i])-this.values[i]))n=i-1;else{if(!(e>=r))break;t=i+1}return new l(i,e-s)}}]),e}(),u=function(){function e(t){(0,i.Z)(this,e),this._values=t,this._isValid=!1,this._validEndIndex=-1,this._prefixSum=[],this._indexBySum=[]}return(0,r.Z)(e,[{key:"getTotalSum",value:function(){return this._ensureValid(),this._indexBySum.length}},{key:"getPrefixSum",value:function(e){return this._ensureValid(),0===e?0:this._prefixSum[e-1]}},{key:"getIndexOf",value:function(e){this._ensureValid();var t=this._indexBySum[e],n=t>0?this._prefixSum[t-1]:0;return new l(t,e-n)}},{key:"removeValues",value:function(e,t){this._values.splice(e,t),this._invalidate(e)}},{key:"insertValues",value:function(e,t){this._values=(0,s.Zv)(this._values,e,t),this._invalidate(e)}},{key:"_invalidate",value:function(e){this._isValid=!1,this._validEndIndex=Math.min(this._validEndIndex,e-1)}},{key:"_ensureValid",value:function(){if(!this._isValid){for(var e=this._validEndIndex+1,t=this._values.length;e<t;e++){var n=this._values[e],i=e>0?this._prefixSum[e-1]:0;this._prefixSum[e]=i+n;for(var r=0;r<n;r++)this._indexBySum[i+r]=e}this._prefixSum.length=this._values.length,this._indexBySum.length=this._prefixSum[this._prefixSum.length-1],this._isValid=!0,this._validEndIndex=this._values.length-1}}},{key:"setValue",value:function(e,t){this._values[e]!==t&&(this._values[e]=t,this._invalidate(e))}}]),e}(),l=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.index=t,this.remainder=n,this._prefixSumIndexOfResultBrand=void 0,this.index=t,this.remainder=n}))},77161:function(e,t,n){n.d(t,{HS:function(){return Pe},qx:function(){return Ve},yO:function(){return Me}});var i=n(37762),r=n(29439),s=n(97326),a=n(11752),o=n(61120),u=n(60136),l=n(27277),h=n(15671),f=n(43144),d=n(71881),c=n(17424),g=n(68552),_=n(28941),v=n(10526),p=n(26684),m=n(50605),C=n(63636),L=n(85889),k=n(10849),b=n(30788),y=n(52091),I=n(18278),x=n(63024),S=n(26765),N=n(36158),T=n(80513),D=n(1901),w=n(42097),M=n(1715),A=n(8689),E=n(28579),z=function(){function e(t,n){(0,h.Z)(this,e),this.piece=t,this.color=n,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}return(0,f.Z)(e,[{key:"next",value:function(){if(this.right!==O)return R(this.right);for(var e=this;e.parent!==O&&e.parent.left!==e;)e=e.parent;return e.parent===O?O:e.parent}},{key:"prev",value:function(){if(this.left!==O)return B(this.left);for(var e=this;e.parent!==O&&e.parent.right!==e;)e=e.parent;return e.parent===O?O:e.parent}},{key:"detach",value:function(){this.parent=null,this.left=null,this.right=null}}]),e}(),O=new z(null,0);function R(e){for(;e.left!==O;)e=e.left;return e}function B(e){for(;e.right!==O;)e=e.right;return e}function F(e){return e===O?0:e.size_left+e.piece.length+F(e.right)}function P(e){return e===O?0:e.lf_left+e.piece.lineFeedCnt+P(e.right)}function V(){O.parent=O}function Z(e,t){var n=t.right;n.size_left+=t.size_left+(t.piece?t.piece.length:0),n.lf_left+=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),t.right=n.left,n.left!==O&&(n.left.parent=t),n.parent=t.parent,t.parent===O?e.root=n:t.parent.left===t?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n}function W(e,t){var n=t.left;t.left=n.right,n.right!==O&&(n.right.parent=t),n.parent=t.parent,t.size_left-=n.size_left+(n.piece?n.piece.length:0),t.lf_left-=n.lf_left+(n.piece?n.piece.lineFeedCnt:0),t.parent===O?e.root=n:t===t.parent.right?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n}function U(e,t){var n,i;if(n=t.left===O?(i=t).right:t.right===O?(i=t).left:(i=R(t.right)).right,i===e.root)return e.root=n,n.color=0,t.detach(),V(),void(e.root.parent=O);var r=1===i.color;if(i===i.parent.left?i.parent.left=n:i.parent.right=n,i===t?(n.parent=i.parent,H(e,n)):(i.parent===t?n.parent=i:n.parent=i.parent,H(e,n),i.left=t.left,i.right=t.right,i.parent=t.parent,i.color=t.color,t===e.root?e.root=i:t===t.parent.left?t.parent.left=i:t.parent.right=i,i.left!==O&&(i.left.parent=i),i.right!==O&&(i.right.parent=i),i.size_left=t.size_left,i.lf_left=t.lf_left,H(e,i)),t.detach(),n.parent.left===n){var s=F(n),a=P(n);if(s!==n.parent.size_left||a!==n.parent.lf_left){var o=s-n.parent.size_left,u=a-n.parent.lf_left;n.parent.size_left=s,n.parent.lf_left=a,Q(e,n.parent,o,u)}}if(H(e,n.parent),r)V();else{for(var l;n!==e.root&&0===n.color;)n===n.parent.left?(1===(l=n.parent.right).color&&(l.color=0,n.parent.color=1,Z(e,n.parent),l=n.parent.right),0===l.left.color&&0===l.right.color?(l.color=1,n=n.parent):(0===l.right.color&&(l.left.color=0,l.color=1,W(e,l),l=n.parent.right),l.color=n.parent.color,n.parent.color=0,l.right.color=0,Z(e,n.parent),n=e.root)):(1===(l=n.parent.left).color&&(l.color=0,n.parent.color=1,W(e,n.parent),l=n.parent.left),0===l.left.color&&0===l.right.color?(l.color=1,n=n.parent):(0===l.left.color&&(l.right.color=0,l.color=1,Z(e,l),l=n.parent.left),l.color=n.parent.color,n.parent.color=0,l.left.color=0,W(e,n.parent),n=e.root));n.color=0,V()}}function j(e,t){for(H(e,t);t!==e.root&&1===t.parent.color;)if(t.parent===t.parent.parent.left){var n=t.parent.parent.right;1===n.color?(t.parent.color=0,n.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.right&&Z(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,W(e,t.parent.parent))}else{var i=t.parent.parent.left;1===i.color?(t.parent.color=0,i.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.left&&W(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,Z(e,t.parent.parent))}e.root.color=0}function Q(e,t,n,i){for(;t!==e.root&&t!==O;)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}function H(e,t){var n,i;if(t!==e.root){for(;t!==e.root&&t===t.parent.right;)t=t.parent;if(t!==e.root)for(n=F((t=t.parent).left)-t.size_left,i=P(t.left)-t.lf_left,t.size_left+=n,t.lf_left+=i;t!==e.root&&(0!==n||0!==i);)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}}O.parent=O,O.left=O,O.right=O,O.color=0;var q=n(37926),G=65535;function J(e){var t;return(t=e[e.length-1]<65536?new Uint16Array(e.length):new Uint32Array(e.length)).set(e,0),t}var Y=(0,f.Z)((function e(t,n,i,r,s){(0,h.Z)(this,e),this.lineStarts=t,this.cr=n,this.lf=i,this.crlf=r,this.isBasicASCII=s}));function $(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[0],i=1,r=0,s=e.length;r<s;r++){var a=e.charCodeAt(r);13===a?r+1<s&&10===e.charCodeAt(r+1)?(n[i++]=r+2,r++):n[i++]=r+1:10===a&&(n[i++]=r+1)}return t?J(n):n}var K=(0,f.Z)((function e(t,n,i,r,s){(0,h.Z)(this,e),this.bufferIndex=t,this.start=n,this.end=i,this.lineFeedCnt=r,this.length=s})),X=(0,f.Z)((function e(t,n){(0,h.Z)(this,e),this.buffer=t,this.lineStarts=n})),ee=function(){function e(t,n){var i=this;(0,h.Z)(this,e),this._pieces=[],this._tree=t,this._BOM=n,this._index=0,t.root!==O&&t.iterate(t.root,(function(e){return e!==O&&i._pieces.push(e.piece),!0}))}return(0,f.Z)(e,[{key:"read",value:function(){return 0===this._pieces.length?0===this._index?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:0===this._index?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}]),e}(),te=function(){function e(t){(0,h.Z)(this,e),this._limit=t,this._cache=[]}return(0,f.Z)(e,[{key:"get",value:function(e){for(var t=this._cache.length-1;t>=0;t--){var n=this._cache[t];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}},{key:"get2",value:function(e){for(var t=this._cache.length-1;t>=0;t--){var n=this._cache[t];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}},{key:"set",value:function(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}},{key:"validate",value:function(e){for(var t=!1,n=this._cache,r=0;r<n.length;r++){var s=n[r];(null===s.node.parent||s.nodeStartOffset>=e)&&(n[r]=null,t=!0)}if(t){var a,o=[],u=(0,i.Z)(n);try{for(u.s();!(a=u.n()).done;){var l=a.value;null!==l&&o.push(l)}}catch(h){u.e(h)}finally{u.f()}this._cache=o}}}]),e}(),ne=function(){function e(t,n,i){(0,h.Z)(this,e),this.create(t,n,i)}return(0,f.Z)(e,[{key:"create",value:function(e,t,n){this._buffers=[new X("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=O,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=n;for(var i=null,r=0,s=e.length;r<s;r++)if(e[r].buffer.length>0){e[r].lineStarts||(e[r].lineStarts=$(e[r].buffer));var a=new K(r+1,{line:0,column:0},{line:e[r].lineStarts.length-1,column:e[r].buffer.length-e[r].lineStarts[e[r].lineStarts.length-1]},e[r].lineStarts.length-1,e[r].buffer.length);this._buffers.push(e[r]),i=this.rbInsertRight(i,a)}this._searchCache=new te(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}},{key:"normalizeEOL",value:function(e){var t=this,n=65535-Math.floor(21845),i=2*n,r="",s=0,a=[];if(this.iterate(this.root,(function(o){var u=t.getNodeContent(o),l=u.length;if(s<=n||s+l<i)return r+=u,s+=l,!0;var h=r.replace(/\r\n|\r|\n/g,e);return a.push(new X(h,$(h))),r=u,s=l,!0})),s>0){var o=r.replace(/\r\n|\r|\n/g,e);a.push(new X(o,$(o)))}this.create(a,e,!0)}},{key:"getEOL",value:function(){return this._EOL}},{key:"setEOL",value:function(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}},{key:"createSnapshot",value:function(e){return new ee(this,e)}},{key:"getOffsetAt",value:function(e,t){for(var n=0,i=this.root;i!==O;)if(i.left!==O&&i.lf_left+1>=e)i=i.left;else{if(i.lf_left+i.piece.lineFeedCnt+1>=e)return(n+=i.size_left)+(this.getAccumulatedValue(i,e-i.lf_left-2)+t-1);e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right}return n}},{key:"getPositionAt",value:function(e){e=Math.floor(e),e=Math.max(0,e);for(var t=this.root,n=0,i=e;t!==O;)if(0!==t.size_left&&t.size_left>=e)t=t.left;else{if(t.size_left+t.piece.length>=e){var r=this.getIndexOf(t,e-t.size_left);if(n+=t.lf_left+r.index,0===r.index){var s=i-this.getOffsetAt(n+1,1);return new k.L(n+1,s+1)}return new k.L(n+1,r.remainder+1)}if(e-=t.size_left+t.piece.length,n+=t.lf_left+t.piece.lineFeedCnt,t.right===O){var a=i-e-this.getOffsetAt(n+1,1);return new k.L(n+1,a+1)}t=t.right}return new k.L(1,1)}},{key:"getValueInRange",value:function(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";var n=this.nodeAt2(e.startLineNumber,e.startColumn),i=this.nodeAt2(e.endLineNumber,e.endColumn),r=this.getValueInRange2(n,i);return t?t===this._EOL&&this._EOLNormalized&&t===this.getEOL()&&this._EOLNormalized?r:r.replace(/\r\n|\r|\n/g,t):r}},{key:"getValueInRange2",value:function(e,t){if(e.node===t.node){var n=e.node,i=this._buffers[n.piece.bufferIndex].buffer,r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i.substring(r+e.remainder,r+t.remainder)}var s=e.node,a=this._buffers[s.piece.bufferIndex].buffer,o=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start),u=a.substring(o+e.remainder,o+s.piece.length);for(s=s.next();s!==O;){var l=this._buffers[s.piece.bufferIndex].buffer,h=this.offsetInBuffer(s.piece.bufferIndex,s.piece.start);if(s===t.node){u+=l.substring(h,h+t.remainder);break}u+=l.substr(h,s.piece.length),s=s.next()}return u}},{key:"getLinesContent",value:function(){var e=this,t=[],n=0,i="",r=!1;return this.iterate(this.root,(function(s){if(s===O)return!0;var a=s.piece,o=a.length;if(0===o)return!0;var u=e._buffers[a.bufferIndex].buffer,l=e._buffers[a.bufferIndex].lineStarts,h=a.start.line,f=a.end.line,d=l[h]+a.start.column;if(r&&(10===u.charCodeAt(d)&&(d++,o--),t[n++]=i,i="",r=!1,0===o))return!0;if(h===f)return e._EOLNormalized||13!==u.charCodeAt(d+o-1)?i+=u.substr(d,o):(r=!0,i+=u.substr(d,o-1)),!0;i+=e._EOLNormalized?u.substring(d,Math.max(d,l[h+1]-e._EOLLength)):u.substring(d,l[h+1]).replace(/(\r\n|\r|\n)$/,""),t[n++]=i;for(var c=h+1;c<f;c++)i=e._EOLNormalized?u.substring(l[c],l[c+1]-e._EOLLength):u.substring(l[c],l[c+1]).replace(/(\r\n|\r|\n)$/,""),t[n++]=i;return e._EOLNormalized||13!==u.charCodeAt(l[f]+a.end.column-1)?i=u.substr(l[f],a.end.column):(r=!0,0===a.end.column?n--:i=u.substr(l[f],a.end.column-1)),!0})),r&&(t[n++]=i,i=""),t[n++]=i,t}},{key:"getLength",value:function(){return this._length}},{key:"getLineCount",value:function(){return this._lineCnt}},{key:"getLineContent",value:function(e){return this._lastVisitedLine.lineNumber===e||(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,"")),this._lastVisitedLine.value}},{key:"_getCharCode",value:function(e){if(e.remainder===e.node.piece.length){var t=e.node.next();if(!t)return 0;var n=this._buffers[t.piece.bufferIndex],i=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return n.buffer.charCodeAt(i)}var r=this._buffers[e.node.piece.bufferIndex],s=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return r.buffer.charCodeAt(s)}},{key:"getLineCharCode",value:function(e,t){var n=this.nodeAt2(e,t+1);return this._getCharCode(n)}},{key:"getLineLength",value:function(e){if(e===this.getLineCount()){var t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}},{key:"findMatchesInNode",value:function(e,t,n,i,r,s,a,o,u,l,h){var f,d,c,g=this._buffers[e.piece.bufferIndex],_=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),v=this.offsetInBuffer(e.piece.bufferIndex,r),p=this.offsetInBuffer(e.piece.bufferIndex,s),m={line:0,column:0};t._wordSeparators?(d=g.buffer.substring(v,p),c=function(e){return e+v},t.reset(0)):(d=g.buffer,c=function(e){return e},t.reset(v));do{if(f=t.next(d)){if(c(f.index)>=p)return l;this.positionInBuffer(e,c(f.index)-_,m);var C=this.getLineFeedCnt(e.piece.bufferIndex,r,m),L=m.line===r.line?m.column-r.column+i:m.column+1,k=L+f[0].length;if(h[l++]=(0,q.iE)(new b.e(n+C,L,n+C,k),f,o),c(f.index)+f[0].length>=p)return l;if(l>=u)return l}}while(f);return l}},{key:"findMatchesLineByLine",value:function(e,t,n,i){var r=[],s=0,a=new q.sz(t.wordSeparators,t.regex),o=this.nodeAt2(e.startLineNumber,e.startColumn);if(null===o)return[];var u=this.nodeAt2(e.endLineNumber,e.endColumn);if(null===u)return[];var l=this.positionInBuffer(o.node,o.remainder),h=this.positionInBuffer(u.node,u.remainder);if(o.node===u.node)return this.findMatchesInNode(o.node,a,e.startLineNumber,e.startColumn,l,h,t,n,i,s,r),r;for(var f=e.startLineNumber,d=o.node;d!==u.node;){var c=this.getLineFeedCnt(d.piece.bufferIndex,l,d.piece.end);if(c>=1){var g=this._buffers[d.piece.bufferIndex].lineStarts,_=this.offsetInBuffer(d.piece.bufferIndex,d.piece.start),v=g[l.line+c],p=f===e.startLineNumber?e.startColumn:1;if((s=this.findMatchesInNode(d,a,f,p,l,this.positionInBuffer(d,v-_),t,n,i,s,r))>=i)return r;f+=c}var m=f===e.startLineNumber?e.startColumn-1:0;if(f===e.endLineNumber){var C=this.getLineContent(f).substring(m,e.endColumn-1);return s=this._findMatchesInLine(t,a,C,e.endLineNumber,m,s,r,n,i),r}if((s=this._findMatchesInLine(t,a,this.getLineContent(f).substr(m),f,m,s,r,n,i))>=i)return r;f++,d=(o=this.nodeAt2(f,1)).node,l=this.positionInBuffer(o.node,o.remainder)}if(f===e.endLineNumber){var L=f===e.startLineNumber?e.startColumn-1:0,k=this.getLineContent(f).substring(L,e.endColumn-1);return s=this._findMatchesInLine(t,a,k,e.endLineNumber,L,s,r,n,i),r}var b=f===e.startLineNumber?e.startColumn:1;return s=this.findMatchesInNode(u.node,a,f,b,l,h,t,n,i,s,r),r}},{key:"_findMatchesInLine",value:function(e,t,n,i,r,s,a,o,u){var l,h=e.wordSeparators;if(!o&&e.simpleSearch){for(var f=e.simpleSearch,d=f.length,c=n.length,g=-d;-1!==(g=n.indexOf(f,g+d));)if((!h||(0,q.cM)(h,n,c,g,d))&&(a[s++]=new N.tk(new b.e(i,g+1+r,i,g+1+d+r),null),s>=u))return s;return s}t.reset(0);do{if((l=t.next(n))&&(a[s++]=(0,q.iE)(new b.e(i,l.index+1+r,i,l.index+1+l[0].length+r),l,o),s>=u))return s}while(l);return s}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==O){var i=this.nodeAt(e),r=i.node,s=i.remainder,a=i.nodeStartOffset,o=r.piece,u=o.bufferIndex,l=this.positionInBuffer(r,s);if(0===r.piece.bufferIndex&&o.end.line===this._lastChangeBufferPos.line&&o.end.column===this._lastChangeBufferPos.column&&a+o.length===e&&t.length<G)return this.appendToNode(r,t),void this.computeBufferMetadata();if(a===e)this.insertContentToNodeLeft(t,r),this._searchCache.validate(e);else if(a+r.piece.length>e){var h=[],f=new K(o.bufferIndex,l,o.end,this.getLineFeedCnt(o.bufferIndex,l,o.end),this.offsetInBuffer(u,o.end)-this.offsetInBuffer(u,l));if(this.shouldCheckCRLF()&&this.endWithCR(t)){var d=this.nodeCharCodeAt(r,s);if(10===d){var c={line:f.start.line+1,column:0};f=new K(f.bufferIndex,c,f.end,this.getLineFeedCnt(f.bufferIndex,c,f.end),f.length-1),t+="\n"}}if(this.shouldCheckCRLF()&&this.startWithLF(t)){var g=this.nodeCharCodeAt(r,s-1);if(13===g){var _=this.positionInBuffer(r,s-1);this.deleteNodeTail(r,_),t="\r"+t,0===r.piece.length&&h.push(r)}else this.deleteNodeTail(r,l)}else this.deleteNodeTail(r,l);var v=this.createNewPieces(t);f.length>0&&this.rbInsertRight(r,f);for(var p=r,m=0;m<v.length;m++)p=this.rbInsertRight(p,v[m]);this.deleteNodes(h)}else this.insertContentToNodeRight(t,r)}else for(var C=this.createNewPieces(t),L=this.rbInsertLeft(null,C[0]),k=1;k<C.length;k++)L=this.rbInsertRight(L,C[k]);this.computeBufferMetadata()}},{key:"delete",value:function(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",!(t<=0||this.root===O)){var n=this.nodeAt(e),i=this.nodeAt(e+t),r=n.node,s=i.node;if(r===s){var a=this.positionInBuffer(r,n.remainder),o=this.positionInBuffer(r,i.remainder);if(n.nodeStartOffset===e){if(t===r.piece.length){var u=r.next();return U(this,r),this.validateCRLFWithPrevNode(u),void this.computeBufferMetadata()}return this.deleteNodeHead(r,o),this._searchCache.validate(e),this.validateCRLFWithPrevNode(r),void this.computeBufferMetadata()}return n.nodeStartOffset+r.piece.length===e+t?(this.deleteNodeTail(r,a),this.validateCRLFWithNextNode(r),void this.computeBufferMetadata()):(this.shrinkNode(r,a,o),void this.computeBufferMetadata())}var l=[],h=this.positionInBuffer(r,n.remainder);this.deleteNodeTail(r,h),this._searchCache.validate(e),0===r.piece.length&&l.push(r);var f=this.positionInBuffer(s,i.remainder);this.deleteNodeHead(s,f),0===s.piece.length&&l.push(s);for(var d=r.next();d!==O&&d!==s;d=d.next())l.push(d);var c=0===r.piece.length?r.prev():r;this.deleteNodes(l),this.validateCRLFWithNextNode(c),this.computeBufferMetadata()}}},{key:"insertContentToNodeLeft",value:function(e,t){var n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){var i=t.piece,r={line:i.start.line+1,column:0},s=new K(i.bufferIndex,r,i.end,this.getLineFeedCnt(i.bufferIndex,r,i.end),i.length-1);t.piece=s,e+="\n",Q(this,t,-1,-1),0===t.piece.length&&n.push(t)}for(var a=this.createNewPieces(e),o=this.rbInsertLeft(t,a[a.length-1]),u=a.length-2;u>=0;u--)o=this.rbInsertLeft(o,a[u]);this.validateCRLFWithPrevNode(o),this.deleteNodes(n)}},{key:"insertContentToNodeRight",value:function(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+="\n");for(var n=this.createNewPieces(e),i=this.rbInsertRight(t,n[0]),r=i,s=1;s<n.length;s++)r=this.rbInsertRight(r,n[s]);this.validateCRLFWithPrevNode(i)}},{key:"positionInBuffer",value:function(e,t,n){for(var i=e.piece,r=e.piece.bufferIndex,s=this._buffers[r].lineStarts,a=s[i.start.line]+i.start.column+t,o=i.start.line,u=i.end.line,l=0,h=0,f=0;o<=u&&(f=s[l=o+(u-o)/2|0],l!==u);)if(h=s[l+1],a<f)u=l-1;else{if(!(a>=h))break;o=l+1}return n?(n.line=l,n.column=a-f,null):{line:l,column:a-f}}},{key:"getLineFeedCnt",value:function(e,t,n){if(0===n.column)return n.line-t.line;var i=this._buffers[e].lineStarts;if(n.line===i.length-1)return n.line-t.line;var r=i[n.line+1],s=i[n.line]+n.column;if(r>s+1)return n.line-t.line;var a=s-1;return 13===this._buffers[e].buffer.charCodeAt(a)?n.line-t.line+1:n.line-t.line}},{key:"offsetInBuffer",value:function(e,t){return this._buffers[e].lineStarts[t.line]+t.column}},{key:"deleteNodes",value:function(e){for(var t=0;t<e.length;t++)U(this,e[t])}},{key:"createNewPieces",value:function(e){if(e.length>G){for(var t=[];e.length>G;){var n=e.charCodeAt(65534),i=void 0;13===n||n>=55296&&n<=56319?(i=e.substring(0,65534),e=e.substring(65534)):(i=e.substring(0,G),e=e.substring(G));var r=$(i);t.push(new K(this._buffers.length,{line:0,column:0},{line:r.length-1,column:i.length-r[r.length-1]},r.length-1,i.length)),this._buffers.push(new X(i,r))}var s=$(e);return t.push(new K(this._buffers.length,{line:0,column:0},{line:s.length-1,column:e.length-s[s.length-1]},s.length-1,e.length)),this._buffers.push(new X(e,s)),t}var a=this._buffers[0].buffer.length,o=$(e,!1),u=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===a&&0!==a&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},u=this._lastChangeBufferPos;for(var l=0;l<o.length;l++)o[l]+=a+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(o.slice(1)),this._buffers[0].buffer+="_"+e,a+=1}else{if(0!==a)for(var h=0;h<o.length;h++)o[h]+=a;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(o.slice(1)),this._buffers[0].buffer+=e}var f=this._buffers[0].buffer.length,d=this._buffers[0].lineStarts.length-1,c={line:d,column:f-this._buffers[0].lineStarts[d]},g=new K(0,u,c,this.getLineFeedCnt(0,u,c),f-a);return this._lastChangeBufferPos=c,[g]}},{key:"getLineRawContent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.root,i="",r=this._searchCache.get2(e);if(r){n=r.node;var s=this.getAccumulatedValue(n,e-r.nodeStartLineNumber-1),a=this._buffers[n.piece.bufferIndex].buffer,o=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(r.nodeStartLineNumber+n.piece.lineFeedCnt!==e){var u=this.getAccumulatedValue(n,e-r.nodeStartLineNumber);return a.substring(o+s,o+u-t)}i=a.substring(o+s,o+n.piece.length)}else for(var l=0,h=e;n!==O;)if(n.left!==O&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){var f=this.getAccumulatedValue(n,e-n.lf_left-2),d=this.getAccumulatedValue(n,e-n.lf_left-1),c=this._buffers[n.piece.bufferIndex].buffer,g=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return l+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:l,nodeStartLineNumber:h-(e-1-n.lf_left)}),c.substring(g+f,g+d-t)}if(n.lf_left+n.piece.lineFeedCnt===e-1){var _=this.getAccumulatedValue(n,e-n.lf_left-2),v=this._buffers[n.piece.bufferIndex].buffer,p=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i=v.substring(p+_,p+n.piece.length);break}e-=n.lf_left+n.piece.lineFeedCnt,l+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==O;){var m=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){var C=this.getAccumulatedValue(n,0),L=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i+=m.substring(L,L+C-t)}var k=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i+=m.substr(k,n.piece.length),n=n.next()}return i}},{key:"computeBufferMetadata",value:function(){for(var e=this.root,t=1,n=0;e!==O;)t+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=n,this._searchCache.validate(this._length)}},{key:"getIndexOf",value:function(e,t){var n=e.piece,i=this.positionInBuffer(e,t),r=i.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===t){var s=this.getLineFeedCnt(e.piece.bufferIndex,n.start,i);if(s!==r)return{index:s,remainder:0}}return{index:r,remainder:i.column}}},{key:"getAccumulatedValue",value:function(e,t){if(t<0)return 0;var n=e.piece,i=this._buffers[n.bufferIndex].lineStarts,r=n.start.line+t+1;return r>n.end.line?i[n.end.line]+n.end.column-i[n.start.line]-n.start.column:i[r]-i[n.start.line]-n.start.column}},{key:"deleteNodeTail",value:function(e,t){var n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.end),s=t,a=this.offsetInBuffer(n.bufferIndex,s),o=this.getLineFeedCnt(n.bufferIndex,n.start,s),u=o-i,l=a-r,h=n.length+l;e.piece=new K(n.bufferIndex,n.start,s,o,h),Q(this,e,l,u)}},{key:"deleteNodeHead",value:function(e,t){var n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.start),s=t,a=this.getLineFeedCnt(n.bufferIndex,s,n.end),o=a-i,u=r-this.offsetInBuffer(n.bufferIndex,s),l=n.length+u;e.piece=new K(n.bufferIndex,s,n.end,a,l),Q(this,e,u,o)}},{key:"shrinkNode",value:function(e,t,n){var i=e.piece,r=i.start,s=i.end,a=i.length,o=i.lineFeedCnt,u=t,l=this.getLineFeedCnt(i.bufferIndex,i.start,u),h=this.offsetInBuffer(i.bufferIndex,t)-this.offsetInBuffer(i.bufferIndex,r);e.piece=new K(i.bufferIndex,i.start,u,l,h),Q(this,e,h-a,l-o);var f=new K(i.bufferIndex,n,s,this.getLineFeedCnt(i.bufferIndex,n,s),this.offsetInBuffer(i.bufferIndex,s)-this.offsetInBuffer(i.bufferIndex,n)),d=this.rbInsertRight(e,f);this.validateCRLFWithPrevNode(d)}},{key:"appendToNode",value:function(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+="\n");var n=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),i=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;for(var r=$(t,!1),s=0;s<r.length;s++)r[s]+=i;if(n){var a=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:i-a}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(r.slice(1));var o=this._buffers[0].lineStarts.length-1,u={line:o,column:this._buffers[0].buffer.length-this._buffers[0].lineStarts[o]},l=e.piece.length+t.length,h=e.piece.lineFeedCnt,f=this.getLineFeedCnt(0,e.piece.start,u),d=f-h;e.piece=new K(e.piece.bufferIndex,e.piece.start,u,f,l),this._lastChangeBufferPos=u,Q(this,e,t.length,d)}},{key:"nodeAt",value:function(e){var t=this.root,n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};for(var i=0;t!==O;)if(t.size_left>e)t=t.left;else{if(t.size_left+t.piece.length>=e){i+=t.size_left;var r={node:t,remainder:e-t.size_left,nodeStartOffset:i};return this._searchCache.set(r),r}e-=t.size_left+t.piece.length,i+=t.size_left+t.piece.length,t=t.right}return null}},{key:"nodeAt2",value:function(e,t){for(var n=this.root,i=0;n!==O;)if(n.left!==O&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){var r=this.getAccumulatedValue(n,e-n.lf_left-2),s=this.getAccumulatedValue(n,e-n.lf_left-1);return i+=n.size_left,{node:n,remainder:Math.min(r+t-1,s),nodeStartOffset:i}}if(n.lf_left+n.piece.lineFeedCnt===e-1){var a=this.getAccumulatedValue(n,e-n.lf_left-2);if(a+t-1<=n.piece.length)return{node:n,remainder:a+t-1,nodeStartOffset:i};t-=n.piece.length-a;break}e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==O;){if(n.piece.lineFeedCnt>0){var o=this.getAccumulatedValue(n,0),u=this.offsetOfNode(n);return{node:n,remainder:Math.min(t-1,o),nodeStartOffset:u}}if(n.piece.length>=t-1)return{node:n,remainder:t-1,nodeStartOffset:this.offsetOfNode(n)};t-=n.piece.length,n=n.next()}return null}},{key:"nodeCharCodeAt",value:function(e,t){if(e.piece.lineFeedCnt<1)return-1;var n=this._buffers[e.piece.bufferIndex],i=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return n.buffer.charCodeAt(i)}},{key:"offsetOfNode",value:function(e){if(!e)return 0;for(var t=e.size_left;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}},{key:"shouldCheckCRLF",value:function(){return!(this._EOLNormalized&&"\n"===this._EOL)}},{key:"startWithLF",value:function(e){if("string"===typeof e)return 10===e.charCodeAt(0);if(e===O||0===e.piece.lineFeedCnt)return!1;var t=e.piece,n=this._buffers[t.bufferIndex].lineStarts,i=t.start.line,r=n[i]+t.start.column;return i!==n.length-1&&(!(n[i+1]>r+1)&&10===this._buffers[t.bufferIndex].buffer.charCodeAt(r))}},{key:"endWithCR",value:function(e){return"string"===typeof e?13===e.charCodeAt(e.length-1):e!==O&&0!==e.piece.lineFeedCnt&&13===this.nodeCharCodeAt(e,e.piece.length-1)}},{key:"validateCRLFWithPrevNode",value:function(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){var t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}},{key:"validateCRLFWithNextNode",value:function(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){var t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}},{key:"fixCRLF",value:function(e,t){var n,i=[],r=this._buffers[e.piece.bufferIndex].lineStarts;n=0===e.piece.end.column?{line:e.piece.end.line-1,column:r[e.piece.end.line]-r[e.piece.end.line-1]-1}:{line:e.piece.end.line,column:e.piece.end.column-1};var s=e.piece.length-1,a=e.piece.lineFeedCnt-1;e.piece=new K(e.piece.bufferIndex,e.piece.start,n,a,s),Q(this,e,-1,-1),0===e.piece.length&&i.push(e);var o={line:t.piece.start.line+1,column:0},u=t.piece.length-1,l=this.getLineFeedCnt(t.piece.bufferIndex,o,t.piece.end);t.piece=new K(t.piece.bufferIndex,o,t.piece.end,l,u),Q(this,t,-1,-1),0===t.piece.length&&i.push(t);var h=this.createNewPieces("\r\n");this.rbInsertRight(e,h[0]);for(var f=0;f<i.length;f++)U(this,i[f])}},{key:"adjustCarriageReturnFromNext",value:function(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){var n=t.next();if(this.startWithLF(n)){if(e+="\n",1===n.piece.length)U(this,n);else{var i=n.piece,r={line:i.start.line+1,column:0},s=i.length-1,a=this.getLineFeedCnt(i.bufferIndex,r,i.end);n.piece=new K(i.bufferIndex,r,i.end,a,s),Q(this,n,-1,-1)}return!0}}return!1}},{key:"iterate",value:function(e,t){if(e===O)return t(O);var n=this.iterate(e.left,t);return n?t(e)&&this.iterate(e.right,t):n}},{key:"getNodeContent",value:function(e){if(e===O)return"";var t=this._buffers[e.piece.bufferIndex],n=e.piece,i=this.offsetInBuffer(n.bufferIndex,n.start),r=this.offsetInBuffer(n.bufferIndex,n.end);return t.buffer.substring(i,r)}},{key:"getPieceContent",value:function(e){var t=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),i=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(n,i)}},{key:"rbInsertRight",value:function(e,t){var n=new z(t,1);if(n.left=O,n.right=O,n.parent=O,n.size_left=0,n.lf_left=0,this.root===O)this.root=n,n.color=0;else if(e.right===O)e.right=n,n.parent=e;else{var i=R(e.right);i.left=n,n.parent=i}return j(this,n),n}},{key:"rbInsertLeft",value:function(e,t){var n=new z(t,1);if(n.left=O,n.right=O,n.parent=O,n.size_left=0,n.lf_left=0,this.root===O)this.root=n,n.color=0;else if(e.left===O)e.left=n,n.parent=e;else{var i=B(e.left);i.right=n,n.parent=i}return j(this,n),n}}]),e}(),ie=n(34742),re=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,r,s,a,o,u){var l;return(0,h.Z)(this,n),(l=t.call(this))._onDidChangeContent=l._register(new _.Q5),l._BOM=i,l._mightContainNonBasicASCII=!o,l._mightContainRTL=s,l._mightContainUnusualLineTerminators=a,l._pieceTree=new ne(e,r,u),l}return(0,f.Z)(n,[{key:"mightContainRTL",value:function(){return this._mightContainRTL}},{key:"mightContainUnusualLineTerminators",value:function(){return this._mightContainUnusualLineTerminators}},{key:"resetMightContainUnusualLineTerminators",value:function(){this._mightContainUnusualLineTerminators=!1}},{key:"mightContainNonBasicASCII",value:function(){return this._mightContainNonBasicASCII}},{key:"getBOM",value:function(){return this._BOM}},{key:"getEOL",value:function(){return this._pieceTree.getEOL()}},{key:"createSnapshot",value:function(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}},{key:"getOffsetAt",value:function(e,t){return this._pieceTree.getOffsetAt(e,t)}},{key:"getPositionAt",value:function(e){return this._pieceTree.getPositionAt(e)}},{key:"getRangeAt",value:function(e,t){var n=e+t,i=this.getPositionAt(e),r=this.getPositionAt(n);return new b.e(i.lineNumber,i.column,r.lineNumber,r.column)}},{key:"getValueInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.isEmpty())return"";var n=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,n)}},{key:"getValueLengthInRange",value:function(e){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;var t=this.getOffsetAt(e.startLineNumber,e.startColumn),n=this.getOffsetAt(e.endLineNumber,e.endColumn);return n-t}},{key:"getCharacterCountInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this._mightContainNonBasicASCII){for(var n=0,i=e.startLineNumber,r=e.endLineNumber,s=i;s<=r;s++)for(var a=this.getLineContent(s),o=s===i?e.startColumn-1:0,u=s===r?e.endColumn-1:a.length,l=o;l<u;l++)p.ZG(a.charCodeAt(l))?(n+=1,l+=1):n+=1;return n+=this._getEndOfLine(t).length*(r-i)}return this.getValueLengthInRange(e,t)}},{key:"getLength",value:function(){return this._pieceTree.getLength()}},{key:"getLineCount",value:function(){return this._pieceTree.getLineCount()}},{key:"getLinesContent",value:function(){return this._pieceTree.getLinesContent()}},{key:"getLineContent",value:function(e){return this._pieceTree.getLineContent(e)}},{key:"getLineCharCode",value:function(e,t){return this._pieceTree.getLineCharCode(e,t)}},{key:"getLineLength",value:function(e){return this._pieceTree.getLineLength(e)}},{key:"getLineFirstNonWhitespaceColumn",value:function(e){var t=p.LC(this.getLineContent(e));return-1===t?0:t+1}},{key:"getLineLastNonWhitespaceColumn",value:function(e){var t=p.ow(this.getLineContent(e));return-1===t?0:t+2}},{key:"_getEndOfLine",value:function(e){switch(e){case 1:return"\n";case 2:return"\r\n";case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}},{key:"setEOL",value:function(e){this._pieceTree.setEOL(e)}},{key:"applyEdits",value:function(e,t,i){for(var s=this._mightContainRTL,a=this._mightContainUnusualLineTerminators,o=this._mightContainNonBasicASCII,u=!0,l=[],h=0;h<e.length;h++){var f=e[h];u&&f._isTracked&&(u=!1);var d=f.range;if(f.text){var c=!0;o||(o=c=!p.$i(f.text)),!s&&c&&(s=p.Ut(f.text)),!a&&c&&(a=p.ab(f.text))}var g="",_=0,v=0,m=0;if(f.text){var L,k=(0,C.Q)(f.text),b=(0,r.Z)(k,4);_=b[0],v=b[1],m=b[2],L=b[3];var y=this.getEOL();g=0===L||L===("\r\n"===y?2:1)?f.text:f.text.replace(/\r\n|\r|\n/g,y)}l[h]={sortIndex:h,identifier:f.identifier||null,range:d,rangeOffset:this.getOffsetAt(d.startLineNumber,d.startColumn),rangeLength:this.getValueLengthInRange(d),text:g,eolCount:_,firstLineLength:v,lastLineLength:m,forceMoveMarkers:Boolean(f.forceMoveMarkers),isAutoWhitespaceEdit:f.isAutoWhitespaceEdit||!1}}l.sort(n._sortOpsAscending);for(var I=!1,x=0,S=l.length-1;x<S;x++){var T=l[x].range.getEndPosition(),D=l[x+1].range.getStartPosition();if(D.isBeforeOrEqual(T)){if(D.isBefore(T))throw new Error("Overlapping ranges are not allowed!");I=!0}}u&&(l=this._reduceOperations(l));var w=i||t?n._getInverseEditRanges(l):[],M=[];if(t)for(var A=0;A<l.length;A++){var E=l[A],z=w[A];if(E.isAutoWhitespaceEdit&&E.range.isEmpty())for(var O=z.startLineNumber;O<=z.endLineNumber;O++){var R="";O===z.startLineNumber&&(R=this.getLineContent(E.range.startLineNumber),-1!==p.LC(R))||M.push({lineNumber:O,oldContent:R})}}var B=null;if(i){var F=0;B=[];for(var P=0;P<l.length;P++){var V=l[P],Z=w[P],W=this.getValueInRange(V.range),U=V.rangeOffset+F;F+=V.text.length-W.length,B[P]={sortIndex:V.sortIndex,identifier:V.identifier,range:Z,text:W,textChange:new ie.q(V.rangeOffset,W,U,V.text)}}I||B.sort((function(e,t){return e.sortIndex-t.sortIndex}))}this._mightContainRTL=s,this._mightContainUnusualLineTerminators=a,this._mightContainNonBasicASCII=o;var j=this._doApplyEdits(l),Q=null;if(t&&M.length>0){M.sort((function(e,t){return t.lineNumber-e.lineNumber})),Q=[];for(var H=0,q=M.length;H<q;H++){var G=M[H].lineNumber;if(!(H>0&&M[H-1].lineNumber===G)){var J=M[H].oldContent,Y=this.getLineContent(G);0!==Y.length&&Y!==J&&-1===p.LC(Y)&&Q.push(G)}}}return this._onDidChangeContent.fire(),new N.je(B,j,Q)}},{key:"_reduceOperations",value:function(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}},{key:"_toSingleEditOperation",value:function(e){for(var t=!1,n=e[0].range,i=e[e.length-1].range,s=new b.e(n.startLineNumber,n.startColumn,i.endLineNumber,i.endColumn),a=n.startLineNumber,o=n.startColumn,u=[],l=0,h=e.length;l<h;l++){var f=e[l],d=f.range;t=t||f.forceMoveMarkers,u.push(this.getValueInRange(new b.e(a,o,d.startLineNumber,d.startColumn))),f.text.length>0&&u.push(f.text),a=d.endLineNumber,o=d.endColumn}var c=u.join(""),g=(0,C.Q)(c),_=(0,r.Z)(g,3),v=_[0],p=_[1],m=_[2];return{sortIndex:0,identifier:e[0].identifier,range:s,rangeOffset:this.getOffsetAt(s.startLineNumber,s.startColumn),rangeLength:this.getValueLengthInRange(s,0),text:c,eolCount:v,firstLineLength:p,lastLineLength:m,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}},{key:"_doApplyEdits",value:function(e){e.sort(n._sortOpsDescending);for(var t=[],i=0;i<e.length;i++){var r=e[i],s=r.range.startLineNumber,a=r.range.startColumn,o=r.range.endLineNumber,u=r.range.endColumn;if(s!==o||a!==u||0!==r.text.length){r.text?(this._pieceTree.delete(r.rangeOffset,r.rangeLength),this._pieceTree.insert(r.rangeOffset,r.text,!0)):this._pieceTree.delete(r.rangeOffset,r.rangeLength);var l=new b.e(s,a,o,u);t.push({range:l,rangeLength:r.rangeLength,text:r.text,rangeOffset:r.rangeOffset,forceMoveMarkers:r.forceMoveMarkers})}}return t}},{key:"findMatchesLineByLine",value:function(e,t,n,i){return this._pieceTree.findMatchesLineByLine(e,t,n,i)}}],[{key:"_getInverseEditRanges",value:function(e){for(var t=[],n=0,i=0,r=null,s=0,a=e.length;s<a;s++){var o=e[s],u=void 0,l=void 0;r?r.range.endLineNumber===o.range.startLineNumber?(u=n,l=i+(o.range.startColumn-r.range.endColumn)):(u=n+(o.range.startLineNumber-r.range.endLineNumber),l=o.range.startColumn):(u=o.range.startLineNumber,l=o.range.startColumn);var h=void 0;if(o.text.length>0){var f=o.eolCount+1;h=1===f?new b.e(u,l,u,l+o.firstLineLength):new b.e(u,l,u+f-1,o.lastLineLength+1)}else h=new b.e(u,l,u,l);n=h.endLineNumber,i=h.endColumn,t.push(h),r=o}return t}},{key:"_sortOpsAscending",value:function(e,t){var n=b.e.compareRangesUsingEnds(e.range,t.range);return 0===n?e.sortIndex-t.sortIndex:n}},{key:"_sortOpsDescending",value:function(e,t){var n=b.e.compareRangesUsingEnds(e.range,t.range);return 0===n?t.sortIndex-e.sortIndex:-n}}]),n}(v.JT),se=function(){function e(t,n,i,r,s,a,o,u,l){(0,h.Z)(this,e),this._chunks=t,this._bom=n,this._cr=i,this._lf=r,this._crlf=s,this._containsRTL=a,this._containsUnusualLineTerminators=o,this._isBasicASCII=u,this._normalizeEOL=l}return(0,f.Z)(e,[{key:"_getEOL",value:function(e){var t=this._cr+this._lf+this._crlf,n=this._cr+this._crlf;return 0===t?1===e?"\n":"\r\n":n>t/2?"\r\n":"\n"}},{key:"create",value:function(e){var t=this._getEOL(e),n=this._chunks;if(this._normalizeEOL&&("\r\n"===t&&(this._cr>0||this._lf>0)||"\n"===t&&(this._cr>0||this._crlf>0)))for(var i=0,r=n.length;i<r;i++){var s=n[i].buffer.replace(/\r\n|\r|\n/g,t),a=$(s);n[i]=new X(s,a)}var o=new re(n,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:o,disposable:o}}}]),e}(),ae=function(){function e(){(0,h.Z)(this,e),this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}return(0,f.Z)(e,[{key:"acceptChunk",value:function(e){if(0!==e.length){0===this.chunks.length&&p.uS(e)&&(this.BOM=p.c1,e=e.substr(1));var t=e.charCodeAt(e.length-1);13===t||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}}},{key:"_acceptChunk1",value:function(e,t){(t||0!==e.length)&&(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}},{key:"_acceptChunk2",value:function(e){var t=function(e,t){e.length=0,e[0]=0;for(var n=1,i=0,r=0,s=0,a=!0,o=0,u=t.length;o<u;o++){var l=t.charCodeAt(o);13===l?o+1<u&&10===t.charCodeAt(o+1)?(s++,e[n++]=o+2,o++):(i++,e[n++]=o+1):10===l?(r++,e[n++]=o+1):a&&9!==l&&(l<32||l>126)&&(a=!1)}var h=new Y(J(e),i,r,s,a);return e.length=0,h}(this._tmpLineStarts,e);this.chunks.push(new X(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,this.isBasicASCII&&(this.isBasicASCII=t.isBasicASCII),this.isBasicASCII||this.containsRTL||(this.containsRTL=p.Ut(e)),this.isBasicASCII||this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=p.ab(e))}},{key:"finish",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._finish(),new se(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}},{key:"_finish",value:function(){if(0===this.chunks.length&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;var e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);var t=$(e.buffer);e.lineStarts=t,13===this._previousChar&&this.cr++}}}]),e}(),oe=n(47433),ue=n(11227),le=n(58705),he=n(56417),fe=n(57942),de=n(9197),ce=n(4723),ge=n(32590),_e=n(4827),ve=function(){function e(t){(0,h.Z)(this,e),this._default=t,this._store=[]}return(0,f.Z)(e,[{key:"get",value:function(e){return e<this._store.length?this._store[e]:this._default}},{key:"set",value:function(e,t){for(;e>=this._store.length;)this._store[this._store.length]=this._default;this._store[e]=t}},{key:"delete",value:function(e,t){0===t||e>=this._store.length||this._store.splice(e,t)}},{key:"insert",value:function(e,t){if(!(0===t||e>=this._store.length)){for(var n=[],i=0;i<t;i++)n[i]=this._default;this._store=d.Zv(this._store,e,n)}}}]),e}(),pe=function(){function e(t,n){(0,h.Z)(this,e),this.tokenizationSupport=t,this.initialState=n,this._lineBeginState=new ve(null),this._lineNeedsTokenization=new ve(!0),this._firstLineNeedsTokenization=0,this._lineBeginState.set(0,this.initialState)}return(0,f.Z)(e,[{key:"invalidLineStartIndex",get:function(){return this._firstLineNeedsTokenization}},{key:"markMustBeTokenized",value:function(e){this._lineNeedsTokenization.set(e,!0),this._firstLineNeedsTokenization=Math.min(this._firstLineNeedsTokenization,e)}},{key:"getBeginState",value:function(e){return this._lineBeginState.get(e)}},{key:"setEndState",value:function(e,t,n){if(this._lineNeedsTokenization.set(t,!1),this._firstLineNeedsTokenization=t+1,t!==e-1){var i=this._lineBeginState.get(t+1);if(null===i||!n.equals(i))return this._lineBeginState.set(t+1,n),void this.markMustBeTokenized(t+1);for(var r=t+1;r<e&&!this._lineNeedsTokenization.get(r);)r++;this._firstLineNeedsTokenization=r}}},{key:"applyEdits",value:function(e,t){this.markMustBeTokenized(e.startLineNumber-1),this._lineBeginState.delete(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineNeedsTokenization.delete(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineBeginState.insert(e.startLineNumber,t),this._lineNeedsTokenization.insert(e.startLineNumber,t)}}]),e}(),me=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,r){var s;return(0,h.Z)(this,n),(s=t.call(this))._textModel=e,s._tokenizationPart=i,s._languageIdCodec=r,s._isScheduled=!1,s._isDisposed=!1,s._tokenizationStateStore=null,s._register(he.RW.onDidChange((function(e){var t=s._textModel.getLanguageId();-1!==e.changedLanguages.indexOf(t)&&(s._resetTokenizationState(),s._tokenizationPart.clearTokens())}))),s._resetTokenizationState(),s}return(0,f.Z)(n,[{key:"dispose",value:function(){this._isDisposed=!0,(0,a.Z)((0,o.Z)(n.prototype),"dispose",this).call(this)}},{key:"handleDidChangeContent",value:function(e){if(e.isFlush)this._resetTokenizationState();else{if(this._tokenizationStateStore)for(var t=0,n=e.changes.length;t<n;t++){var i=e.changes[t],s=(0,C.Q)(i.text),a=(0,r.Z)(s,1)[0];this._tokenizationStateStore.applyEdits(i.range,a)}this._beginBackgroundTokenization()}}},{key:"handleDidChangeAttached",value:function(){this._beginBackgroundTokenization()}},{key:"handleDidChangeLanguage",value:function(e){this._resetTokenizationState(),this._tokenizationPart.clearTokens()}},{key:"_resetTokenizationState",value:function(){var e=function(e,t){if(e.isTooLargeForTokenization())return[null,null];var n,i=he.RW.get(t.getLanguageId());if(!i)return[null,null];try{n=i.getInitialState()}catch(r){return(0,g.dL)(r),[null,null]}return[i,n]}(this._textModel,this._tokenizationPart),t=(0,r.Z)(e,2),n=t[0],i=t[1];this._tokenizationStateStore=n&&i?new pe(n,i):null,this._beginBackgroundTokenization()}},{key:"_beginBackgroundTokenization",value:function(){var e=this;!this._isScheduled&&this._textModel.isAttachedToEditor()&&this._hasLinesToTokenize()&&(this._isScheduled=!0,(0,ge.To)((function(t){e._isScheduled=!1,e._backgroundTokenizeWithDeadline(t)})))}},{key:"_backgroundTokenizeWithDeadline",value:function(e){var t=this,n=Date.now()+e.timeRemaining();!function e(){!t._isDisposed&&t._textModel.isAttachedToEditor()&&t._hasLinesToTokenize()&&(t._backgroundTokenizeForAtLeast1ms(),Date.now()<n?(0,_e.fn)(e):t._beginBackgroundTokenization())}()}},{key:"_backgroundTokenizeForAtLeast1ms",value:function(){var e=this._textModel.getLineCount(),t=new ce.N,n=de.G.create(!1);do{if(n.elapsed()>1)break;if(this._tokenizeOneInvalidLine(t)>=e)break}while(this._hasLinesToTokenize());this._tokenizationPart.setTokens(t.finalize(),this._isTokenizationComplete())}},{key:"tokenizeViewport",value:function(e,t){var n=new ce.N;this._tokenizeViewport(n,e,t),this._tokenizationPart.setTokens(n.finalize(),this._isTokenizationComplete())}},{key:"reset",value:function(){this._resetTokenizationState(),this._tokenizationPart.clearTokens()}},{key:"forceTokenization",value:function(e){var t=new ce.N;this._updateTokensUntilLine(t,e),this._tokenizationPart.setTokens(t.finalize(),this._isTokenizationComplete())}},{key:"getTokenTypeIfInsertingCharacter",value:function(e,t){if(!this._tokenizationStateStore)return 0;this.forceTokenization(e.lineNumber);var n=this._tokenizationStateStore.getBeginState(e.lineNumber-1);if(!n)return 0;var i=this._textModel.getLanguageId(),r=this._textModel.getLineContent(e.lineNumber),s=r.substring(0,e.column-1)+t+r.substring(e.column-1),a=Ce(this._languageIdCodec,i,this._tokenizationStateStore.tokenizationSupport,s,!0,n),o=new le.A(a.tokens,s,this._languageIdCodec);if(0===o.getCount())return 0;var u=o.findTokenIndexAtOffset(e.column-1);return o.getStandardTokenType(u)}},{key:"tokenizeLineWithEdit",value:function(e,t,n){var i=e.lineNumber,r=e.column;if(!this._tokenizationStateStore)return null;this.forceTokenization(i);var s=this._tokenizationStateStore.getBeginState(i-1);if(!s)return null;var a=this._textModel.getLineContent(i),o=a.substring(0,r-1)+n+a.substring(r-1+t),u=this._textModel.getLanguageIdAtPosition(i,0),l=Ce(this._languageIdCodec,u,this._tokenizationStateStore.tokenizationSupport,o,!0,s);return new le.A(l.tokens,o,this._languageIdCodec)}},{key:"isCheapToTokenize",value:function(e){if(!this._tokenizationStateStore)return!0;var t=this._tokenizationStateStore.invalidLineStartIndex+1;return!(e>t)&&(e<t||this._textModel.getLineLength(e)<2048)}},{key:"_hasLinesToTokenize",value:function(){return!!this._tokenizationStateStore&&this._tokenizationStateStore.invalidLineStartIndex<this._textModel.getLineCount()}},{key:"_isTokenizationComplete",value:function(){return!!this._tokenizationStateStore&&this._tokenizationStateStore.invalidLineStartIndex>=this._textModel.getLineCount()}},{key:"_tokenizeOneInvalidLine",value:function(e){if(!this._tokenizationStateStore||!this._hasLinesToTokenize())return this._textModel.getLineCount()+1;var t=this._tokenizationStateStore.invalidLineStartIndex+1;return this._updateTokensUntilLine(e,t),t}},{key:"_updateTokensUntilLine",value:function(e,t){if(this._tokenizationStateStore)for(var n=this._textModel.getLanguageId(),i=this._textModel.getLineCount(),r=t-1,s=this._tokenizationStateStore.invalidLineStartIndex;s<=r;s++){var a=this._textModel.getLineContent(s+1),o=this._tokenizationStateStore.getBeginState(s),u=Ce(this._languageIdCodec,n,this._tokenizationStateStore.tokenizationSupport,a,!0,o);e.add(s+1,u.tokens),this._tokenizationStateStore.setEndState(i,s,u.endState),s=this._tokenizationStateStore.invalidLineStartIndex-1}}},{key:"_tokenizeViewport",value:function(e,t,n){if(this._tokenizationStateStore&&!(n<=this._tokenizationStateStore.invalidLineStartIndex))if(t<=this._tokenizationStateStore.invalidLineStartIndex)this._updateTokensUntilLine(e,n);else{for(var i=this._textModel.getLineFirstNonWhitespaceColumn(t),r=[],s=null,a=t-1;i>1&&a>=1;a--){var o=this._textModel.getLineFirstNonWhitespaceColumn(a);if(0!==o&&(o<i&&(r.push(this._textModel.getLineContent(a)),i=o,s=this._tokenizationStateStore.getBeginState(a-1))))break}s||(s=this._tokenizationStateStore.initialState);for(var u=this._textModel.getLanguageId(),l=s,h=r.length-1;h>=0;h--){l=Ce(this._languageIdCodec,u,this._tokenizationStateStore.tokenizationSupport,r[h],!1,l).endState}for(var f=t;f<=n;f++){var d=this._textModel.getLineContent(f),c=Ce(this._languageIdCodec,u,this._tokenizationStateStore.tokenizationSupport,d,!0,l);e.add(f,c.tokens),this._tokenizationStateStore.markMustBeTokenized(f-1),l=c.endState}}}}]),n}(v.JT);function Ce(e,t,n,i,r,s){var a=null;if(n)try{a=n.tokenizeEncoded(i,r,s.clone())}catch(o){(0,g.dL)(o)}return a||(a=(0,fe.Dy)(e.encodeLanguageId(t),s)),le.A.convertToEndOffset(a.tokens,i.length),a}var Le=n(10594),ke=n(22695),be=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,r,a,o){var u;return(0,h.Z)(this,n),(u=t.call(this))._languageService=e,u._languageConfigurationService=i,u._textModel=r,u.bracketPairsTextModelPart=a,u._languageId=o,u._onDidChangeLanguage=u._register(new _.Q5),u.onDidChangeLanguage=u._onDidChangeLanguage.event,u._onDidChangeLanguageConfiguration=u._register(new _.Q5),u.onDidChangeLanguageConfiguration=u._onDidChangeLanguageConfiguration.event,u._onDidChangeTokens=u._register(new _.Q5),u.onDidChangeTokens=u._onDidChangeTokens.event,u._backgroundTokenizationState=0,u._onBackgroundTokenizationStateChanged=u._register(new _.Q5),u._tokens=new Le.l(u._languageService.languageIdCodec),u._semanticTokens=new ke.u(u._languageService.languageIdCodec),u._tokenization=new me(r,(0,s.Z)(u),u._languageService.languageIdCodec),u._languageRegistryListener=u._languageConfigurationService.onDidChange((function(e){e.affects(u._languageId)&&u._onDidChangeLanguageConfiguration.fire({})})),u}return(0,f.Z)(n,[{key:"acceptEdit",value:function(e,t,n,i,r){this._tokens.acceptEdit(e,n,i),this._semanticTokens.acceptEdit(e,n,i,r,t.length>0?t.charCodeAt(0):0)}},{key:"handleDidChangeAttached",value:function(){this._tokenization.handleDidChangeAttached()}},{key:"flush",value:function(){this._tokens.flush(),this._semanticTokens.flush()}},{key:"handleDidChangeContent",value:function(e){this._tokenization.handleDidChangeContent(e)}},{key:"dispose",value:function(){this._languageRegistryListener.dispose(),this._tokenization.dispose(),(0,a.Z)((0,o.Z)(n.prototype),"dispose",this).call(this)}},{key:"backgroundTokenizationState",get:function(){return this._backgroundTokenizationState}},{key:"handleTokenizationProgress",value:function(e){if(2!==this._backgroundTokenizationState){var t=e?2:1;this._backgroundTokenizationState!==t&&(this._backgroundTokenizationState=t,this.bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState(),this._onBackgroundTokenizationStateChanged.fire())}}},{key:"setTokens",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){for(var n=[],i=0,r=e.length;i<r;i++){for(var s=e[i],a=0,o=0,u=!1,l=s.startLineNumber;l<=s.endLineNumber;l++)if(u)this._tokens.setTokens(this._languageId,l-1,this._textModel.getLineLength(l),s.getLineTokens(l),!1),o=l;else{var h=this._tokens.setTokens(this._languageId,l-1,this._textModel.getLineLength(l),s.getLineTokens(l),!0);h&&(u=!0,a=l,o=l)}u&&n.push({fromLineNumber:a,toLineNumber:o})}n.length>0&&this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!1,ranges:n})}this.handleTokenizationProgress(t)}},{key:"setSemanticTokens",value:function(e,t){this._semanticTokens.set(e,t),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:null!==e,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}},{key:"hasCompleteSemanticTokens",value:function(){return this._semanticTokens.isComplete()}},{key:"hasSomeSemanticTokens",value:function(){return!this._semanticTokens.isEmpty()}},{key:"setPartialSemanticTokens",value:function(e,t){if(!this.hasCompleteSemanticTokens()){var n=this._textModel.validateRange(this._semanticTokens.setPartial(e,t));this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}}},{key:"tokenizeViewport",value:function(e,t){e=Math.max(1,e),t=Math.min(this._textModel.getLineCount(),t),this._tokenization.tokenizeViewport(e,t)}},{key:"clearTokens",value:function(){this._tokens.flush(),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!0,semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}},{key:"_emitModelTokensChangedEvent",value:function(e){this._textModel._isDisposing()||(this.bracketPairsTextModelPart.handleDidChangeTokens(e),this._onDidChangeTokens.fire(e))}},{key:"resetTokenization",value:function(){this._tokenization.reset()}},{key:"forceTokenization",value:function(e){if(e<1||e>this._textModel.getLineCount())throw new Error("Illegal value for lineNumber");this._tokenization.forceTokenization(e)}},{key:"isCheapToTokenize",value:function(e){return this._tokenization.isCheapToTokenize(e)}},{key:"tokenizeIfCheap",value:function(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}},{key:"getLineTokens",value:function(e){if(e<1||e>this._textModel.getLineCount())throw new Error("Illegal value for lineNumber");return this._getLineTokens(e)}},{key:"_getLineTokens",value:function(e){var t=this._textModel.getLineContent(e),n=this._tokens.getTokens(this._languageId,e-1,t);return this._semanticTokens.addSparseTokens(e,n)}},{key:"getTokenTypeIfInsertingCharacter",value:function(e,t,n){var i=this._textModel.validatePosition(new k.L(e,t));return this._tokenization.getTokenTypeIfInsertingCharacter(i,n)}},{key:"tokenizeLineWithEdit",value:function(e,t,n){var i=this._textModel.validatePosition(e);return this._tokenization.tokenizeLineWithEdit(i,t,n)}},{key:"getLanguageConfiguration",value:function(e){return this._languageConfigurationService.getLanguageConfiguration(e)}},{key:"getWordAtPosition",value:function(e){this.assertNotDisposed();var t=this._textModel.validatePosition(e),i=this._textModel.getLineContent(t.lineNumber),s=this._getLineTokens(t.lineNumber),a=s.findTokenIndexAtOffset(t.column-1),o=n._findLanguageBoundaries(s,a),u=(0,r.Z)(o,2),l=u[0],h=u[1],f=(0,oe.t2)(t.column,this.getLanguageConfiguration(s.getLanguageId(a)).getWordDefinition(),i.substring(l,h),l);if(f&&f.startColumn<=e.column&&e.column<=f.endColumn)return f;if(a>0&&l===t.column-1){var d=n._findLanguageBoundaries(s,a-1),c=(0,r.Z)(d,2),g=c[0],_=c[1],v=(0,oe.t2)(t.column,this.getLanguageConfiguration(s.getLanguageId(a-1)).getWordDefinition(),i.substring(g,_),g);if(v&&v.startColumn<=e.column&&e.column<=v.endColumn)return v}return null}},{key:"getWordUntilPosition",value:function(e){var t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}},{key:"getLanguageId",value:function(){return this._languageId}},{key:"getLanguageIdAtPosition",value:function(e,t){var n=this._textModel.validatePosition(new k.L(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}},{key:"setLanguageId",value:function(e){if(this._languageId!==e){var t={oldLanguage:this._languageId,newLanguage:e};this._languageId=e,this.bracketPairsTextModelPart.handleDidChangeLanguage(t),this._tokenization.handleDidChangeLanguage(t),this._onDidChangeLanguage.fire(t),this._onDidChangeLanguageConfiguration.fire({})}}}],[{key:"_findLanguageBoundaries",value:function(e,t){for(var n=e.getLanguageId(t),i=0,r=t;r>=0&&e.getLanguageId(r)===n;r--)i=e.getStartOffset(r);for(var s=e.getLineContent().length,a=t,o=e.getCount();a<o&&e.getLanguageId(a)===n;a++)s=e.getEndOffset(a);return[i,s]}}]),n}(ue.U),ye=n(94583),Ie=n(10217),xe=function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},Se=function(e,t){return function(n,i){t(n,i,e)}};function Ne(e,t){return("string"===typeof e?function(e){var t=new ae;return t.acceptChunk(e),t.finish()}(e):N.Hf(e)?function(e){for(var t,n=new ae;"string"===typeof(t=e.read());)n.acceptChunk(t);return n.finish()}(e):e).create(t)}var Te=0,De=function(){function e(t){(0,h.Z)(this,e),this._source=t,this._eos=!1}return(0,f.Z)(e,[{key:"read",value:function(){if(this._eos)return null;for(var e=[],t=0,n=0;;){var i=this._source.read();if(null===i)return this._eos=!0,0===t?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=65536)return e.join("")}}}]),e}(),we=function(){throw new Error("Invalid change accessor")},Me=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;(0,h.Z)(this,n),(a=t.call(this))._undoRedoService=u,a._languageService=l,a._languageConfigurationService=f,a._onWillDispose=a._register(new _.Q5),a.onWillDispose=a._onWillDispose.event,a._onDidChangeDecorations=a._register(new Ue((function(e){return a.handleBeforeFireDecorationsChangedEvent(e)}))),a.onDidChangeDecorations=a._onDidChangeDecorations.event,a._onDidChangeOptions=a._register(new _.Q5),a.onDidChangeOptions=a._onDidChangeOptions.event,a._onDidChangeAttached=a._register(new _.Q5),a.onDidChangeAttached=a._onDidChangeAttached.event,a._onDidChangeInjectedText=a._register(new _.Q5),a._eventEmitter=a._register(new je),a._deltaDecorationCallCnt=0,Te++,a.id="$model"+Te,a.isForSimpleWidget=r.isForSimpleWidget,a._associatedResource="undefined"===typeof o||null===o?m.o.parse("inmemory://model/"+Te):o,a._attachedEditorCount=0;var d=Ne(e,r.defaultEOL),c=d.textBuffer,g=d.disposable;a._buffer=c,a._bufferDisposable=g,a._options=n.resolveOptions(a._buffer,r),a._bracketPairs=a._register(new T.Q((0,s.Z)(a),a._languageConfigurationService)),a._guidesTextModelPart=a._register(new M.l((0,s.Z)(a),a._languageConfigurationService)),a._decorationProvider=a._register(new D.z((0,s.Z)(a))),a._tokenizationTextModelPart=new be(a._languageService,a._languageConfigurationService,(0,s.Z)(a),a._bracketPairs,i);var v=a._buffer.getLineCount(),C=a._buffer.getValueLengthInRange(new b.e(1,1,v,a._buffer.getLineLength(v)+1),0);return r.largeFileOptimizations?a._isTooLargeForTokenization=C>n.LARGE_FILE_SIZE_THRESHOLD||v>n.LARGE_FILE_LINE_COUNT_THRESHOLD:a._isTooLargeForTokenization=!1,a._isTooLargeForSyncing=C>n.MODEL_SYNC_LIMIT,a._versionId=1,a._alternativeVersionId=1,a._initialUndoRedoSnapshot=null,a._isDisposed=!1,a.__isDisposing=!1,a._instanceId=p.PJ(Te),a._lastDecorationId=0,a._decorations=Object.create(null),a._decorationsTree=new ze,a._commandManager=new w.NL((0,s.Z)(a),a._undoRedoService),a._isUndoing=!1,a._isRedoing=!1,a._trimAutoWhitespaceLines=null,a._register(a._decorationProvider.onDidChange((function(){a._onDidChangeDecorations.beginDeferredEmit(),a._onDidChangeDecorations.fire(),a._onDidChangeDecorations.endDeferredEmit()}))),a}return(0,f.Z)(n,[{key:"onDidChangeLanguage",get:function(){return this._tokenizationTextModelPart.onDidChangeLanguage}},{key:"onDidChangeLanguageConfiguration",get:function(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}},{key:"onDidChangeTokens",get:function(){return this._tokenizationTextModelPart.onDidChangeTokens}},{key:"onDidChangeContent",value:function(e){return this._eventEmitter.slowEvent((function(t){return e(t.contentChangedEvent)}))}},{key:"onDidChangeContentOrInjectedText",value:function(e){return(0,v.F8)(this._eventEmitter.fastEvent((function(t){return e(t)})),this._onDidChangeInjectedText.event((function(t){return e(t)})))}},{key:"_isDisposing",value:function(){return this.__isDisposing}},{key:"tokenization",get:function(){return this._tokenizationTextModelPart}},{key:"bracketPairs",get:function(){return this._bracketPairs}},{key:"guides",get:function(){return this._guidesTextModelPart}},{key:"dispose",value:function(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,(0,a.Z)((0,o.Z)(n.prototype),"dispose",this).call(this),this._bufferDisposable.dispose(),this.__isDisposing=!1;var e=new re([],"","\n",!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=v.JT.None}},{key:"_assertNotDisposed",value:function(){if(this._isDisposed)throw new Error("Model is disposed!")}},{key:"_emitContentChangedEvent",value:function(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new ye.fV(e,t)))}},{key:"setValue",value:function(e){if(this._assertNotDisposed(),null!==e){var t=Ne(e,this._options.defaultEOL),n=t.textBuffer,i=t.disposable;this._setValueFromTextBuffer(n,i)}}},{key:"_createContentChanged2",value:function(e,t,n,i,r,s,a){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:r,isRedoing:s,isFlush:a}}},{key:"_setValueFromTextBuffer",value:function(e,t){this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._tokenizationTextModelPart.flush(),this._decorations=Object.create(null),this._decorationsTree=new ze,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new ye.dQ([new ye.Jx],this._versionId,!1,!1),this._createContentChanged2(new b.e(1,1,r,s),0,i,this.getValue(),!1,!1,!0))}},{key:"setEOL",value:function(e){this._assertNotDisposed();var t=1===e?"\r\n":"\n";if(this._buffer.getEOL()!==t){var n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new ye.dQ([new ye.CZ],this._versionId,!1,!1),this._createContentChanged2(new b.e(1,1,r,s),0,i,this.getValue(),!1,!1,!1))}}},{key:"_onBeforeEOLChange",value:function(){this._decorationsTree.ensureAllNodesHaveRanges(this)}},{key:"_onAfterEOLChange",value:function(){for(var e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder(),n=0,i=t.length;n<i;n++){var r=t[n],s=r.range,a=r.cachedAbsoluteStart-r.start,o=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),u=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);r.cachedAbsoluteStart=o,r.cachedAbsoluteEnd=u,r.cachedVersionId=e,r.start=o-a,r.end=u-a,(0,E.sR)(r)}}},{key:"onBeforeAttached",value:function(){this._attachedEditorCount++,1===this._attachedEditorCount&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0))}},{key:"onBeforeDetached",value:function(){this._attachedEditorCount--,0===this._attachedEditorCount&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0))}},{key:"isAttachedToEditor",value:function(){return this._attachedEditorCount>0}},{key:"getAttachedEditorCount",value:function(){return this._attachedEditorCount}},{key:"isTooLargeForSyncing",value:function(){return this._isTooLargeForSyncing}},{key:"isTooLargeForTokenization",value:function(){return this._isTooLargeForTokenization}},{key:"isDisposed",value:function(){return this._isDisposed}},{key:"isDominatedByLongLines",value:function(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;for(var e=0,t=0,n=this._buffer.getLineCount(),i=1;i<=n;i++){var r=this._buffer.getLineLength(i);r>=1e4?t+=r:e+=r}return t>e}},{key:"uri",get:function(){return this._associatedResource}},{key:"getOptions",value:function(){return this._assertNotDisposed(),this._options}},{key:"getFormattingOptions",value:function(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}},{key:"updateOptions",value:function(e){this._assertNotDisposed();var t="undefined"!==typeof e.tabSize?e.tabSize:this._options.tabSize,n="undefined"!==typeof e.indentSize?e.indentSize:this._options.indentSize,i="undefined"!==typeof e.insertSpaces?e.insertSpaces:this._options.insertSpaces,r="undefined"!==typeof e.trimAutoWhitespace?e.trimAutoWhitespace:this._options.trimAutoWhitespace,s="undefined"!==typeof e.bracketColorizationOptions?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,a=new N.dJ({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r,bracketPairColorizationOptions:s});if(!this._options.equals(a)){var o=this._options.createChangeEvent(a);this._options=a,this._bracketPairs.handleDidChangeOptions(o),this._decorationProvider.handleDidChangeOptions(o),this._onDidChangeOptions.fire(o)}}},{key:"detectIndentation",value:function(e,t){this._assertNotDisposed();var n=(0,A.L)(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}},{key:"normalizeIndentation",value:function(e){return this._assertNotDisposed(),(0,L.x)(e,this._options.indentSize,this._options.insertSpaces)}},{key:"getVersionId",value:function(){return this._assertNotDisposed(),this._versionId}},{key:"mightContainRTL",value:function(){return this._buffer.mightContainRTL()}},{key:"mightContainUnusualLineTerminators",value:function(){return this._buffer.mightContainUnusualLineTerminators()}},{key:"removeUnusualLineTerminators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.findMatches(p.Qe.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map((function(e){return{range:e.range,text:null}})),(function(){return null}))}},{key:"mightContainNonBasicASCII",value:function(){return this._buffer.mightContainNonBasicASCII()}},{key:"getAlternativeVersionId",value:function(){return this._assertNotDisposed(),this._alternativeVersionId}},{key:"getInitialUndoRedoSnapshot",value:function(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}},{key:"getOffsetAt",value:function(e){this._assertNotDisposed();var t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}},{key:"getPositionAt",value:function(e){this._assertNotDisposed();var t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}},{key:"_increaseVersionId",value:function(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}},{key:"_overwriteVersionId",value:function(e){this._versionId=e}},{key:"_overwriteAlternativeVersionId",value:function(e){this._alternativeVersionId=e}},{key:"_overwriteInitialUndoRedoSnapshot",value:function(e){this._initialUndoRedoSnapshot=e}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}},{key:"createSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new De(this._buffer.createSnapshot(e))}},{key:"getValueLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._assertNotDisposed();var n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}},{key:"getValueInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}},{key:"getValueLengthInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}},{key:"getCharacterCountInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}},{key:"getLineCount",value:function(){return this._assertNotDisposed(),this._buffer.getLineCount()}},{key:"getLineContent",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineContent(e)}},{key:"getLineLength",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)}},{key:"getLinesContent",value:function(){return this._assertNotDisposed(),this._buffer.getLinesContent()}},{key:"getEOL",value:function(){return this._assertNotDisposed(),this._buffer.getEOL()}},{key:"getEndOfLineSequence",value:function(){return this._assertNotDisposed(),"\n"===this._buffer.getEOL()?0:1}},{key:"getLineMinColumn",value:function(e){return this._assertNotDisposed(),1}},{key:"getLineMaxColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}},{key:"getLineFirstNonWhitespaceColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}},{key:"getLineLastNonWhitespaceColumn",value:function(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}},{key:"_validateRangeRelaxedNoAllocations",value:function(e){var t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn,r=Math.floor("number"!==typeof n||isNaN(n)?1:n),s=Math.floor("number"!==typeof i||isNaN(i)?1:i);if(r<1)r=1,s=1;else if(r>t)r=t,s=this.getLineMaxColumn(r);else if(s<=1)s=1;else{var a=this.getLineMaxColumn(r);s>=a&&(s=a)}var o=e.endLineNumber,u=e.endColumn,l=Math.floor("number"!==typeof o||isNaN(o)?1:o),h=Math.floor("number"!==typeof u||isNaN(u)?1:u);if(l<1)l=1,h=1;else if(l>t)l=t,h=this.getLineMaxColumn(l);else if(h<=1)h=1;else{var f=this.getLineMaxColumn(l);h>=f&&(h=f)}return n===r&&i===s&&o===l&&u===h&&e instanceof b.e&&!(e instanceof y.Y)?e:new b.e(r,s,l,h)}},{key:"_isValidPosition",value:function(e,t,n){if("number"!==typeof e||"number"!==typeof t)return!1;if(isNaN(e)||isNaN(t))return!1;if(e<1||t<1)return!1;if((0|e)!==e||(0|t)!==t)return!1;if(e>this._buffer.getLineCount())return!1;if(1===t)return!0;if(t>this.getLineMaxColumn(e))return!1;if(1===n){var i=this._buffer.getLineCharCode(e,t-2);if(p.ZG(i))return!1}return!0}},{key:"_validatePosition",value:function(e,t,n){var i=Math.floor("number"!==typeof e||isNaN(e)?1:e),r=Math.floor("number"!==typeof t||isNaN(t)?1:t),s=this._buffer.getLineCount();if(i<1)return new k.L(1,1);if(i>s)return new k.L(s,this.getLineMaxColumn(s));if(r<=1)return new k.L(i,1);var a=this.getLineMaxColumn(i);if(r>=a)return new k.L(i,a);if(1===n){var o=this._buffer.getLineCharCode(i,r-2);if(p.ZG(o))return new k.L(i,r-1)}return new k.L(i,r)}},{key:"validatePosition",value:function(e){return this._assertNotDisposed(),e instanceof k.L&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}},{key:"_isValidRange",value:function(e,t){var n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,s=e.endColumn;if(!this._isValidPosition(n,i,0))return!1;if(!this._isValidPosition(r,s,0))return!1;if(1===t){var a=i>1?this._buffer.getLineCharCode(n,i-2):0,o=s>1&&s<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,s-2):0,u=p.ZG(a),l=p.ZG(o);return!u&&!l}return!0}},{key:"validateRange",value:function(e){if(this._assertNotDisposed(),e instanceof b.e&&!(e instanceof y.Y)&&this._isValidRange(e,1))return e;var t=this._validatePosition(e.startLineNumber,e.startColumn,0),n=this._validatePosition(e.endLineNumber,e.endColumn,0),i=t.lineNumber,r=t.column,s=n.lineNumber,a=n.column,o=r>1?this._buffer.getLineCharCode(i,r-2):0,u=a>1&&a<=this._buffer.getLineLength(s)?this._buffer.getLineCharCode(s,a-2):0,l=p.ZG(o),h=p.ZG(u);return l||h?i===s&&r===a?new b.e(i,r-1,s,a-1):l&&h?new b.e(i,r-1,s,a+1):l?new b.e(i,r-1,s,a):new b.e(i,r,s,a+1):new b.e(i,r,s,a)}},{key:"modifyPosition",value:function(e,t){this._assertNotDisposed();var n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}},{key:"getFullModelRange",value:function(){this._assertNotDisposed();var e=this.getLineCount();return new b.e(1,1,e,this.getLineMaxColumn(e))}},{key:"findMatchesLineByLine",value:function(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}},{key:"findMatches",value:function(e,t,n,i,r,s){var a=this,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:999;this._assertNotDisposed();var u=null;null!==t&&(Array.isArray(t)||(t=[t]),t.every((function(e){return b.e.isIRange(e)}))&&(u=t.map((function(e){return a.validateRange(e)})))),null===u&&(u=[this.getFullModelRange()]),u=u.sort((function(e,t){return e.startLineNumber-t.startLineNumber||e.startColumn-t.startColumn}));var l,h=[];if(h.push(u.reduce((function(e,t){return b.e.areIntersecting(e,t)?e.plusRange(t):(h.push(e),t)}))),!n&&e.indexOf("\n")<0){var f=new q.bc(e,n,i,r),d=f.parseSearchRequest();if(!d)return[];l=function(e){return a.findMatchesLineByLine(e,d,s,o)}}else l=function(t){return q.pM.findMatches(a,new q.bc(e,n,i,r),t,s,o)};return h.map(l).reduce((function(e,t){return e.concat(t)}),[])}},{key:"findNextMatch",value:function(e,t,n,i,r,s){this._assertNotDisposed();var a=this.validatePosition(t);if(!n&&e.indexOf("\n")<0){var o=new q.bc(e,n,i,r).parseSearchRequest();if(!o)return null;var u=this.getLineCount(),l=new b.e(a.lineNumber,a.column,u,this.getLineMaxColumn(u)),h=this.findMatchesLineByLine(l,o,s,1);return q.pM.findNextMatch(this,new q.bc(e,n,i,r),a,s),h.length>0?h[0]:(l=new b.e(1,1,a.lineNumber,this.getLineMaxColumn(a.lineNumber)),(h=this.findMatchesLineByLine(l,o,s,1)).length>0?h[0]:null)}return q.pM.findNextMatch(this,new q.bc(e,n,i,r),a,s)}},{key:"findPreviousMatch",value:function(e,t,n,i,r,s){this._assertNotDisposed();var a=this.validatePosition(t);return q.pM.findPreviousMatch(this,new q.bc(e,n,i,r),a,s)}},{key:"pushStackElement",value:function(){this._commandManager.pushStackElement()}},{key:"popStackElement",value:function(){this._commandManager.popStackElement()}},{key:"pushEOL",value:function(e){if(("\n"===this.getEOL()?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_validateEditOperation",value:function(e){return e instanceof N.Qi?e:new N.Qi(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}},{key:"_validateEditOperations",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}},{key:"pushEditOperations",value:function(e,t,n){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_pushEditOperations",value:function(e,t,n){var i=this;if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){var r=t.map((function(e){return{range:i.validateRange(e.range),text:e.text}})),s=!0;if(e)for(var a=0,o=e.length;a<o;a++){for(var u=e[a],l=!1,h=0,f=r.length;h<f;h++){var d=r[h].range,c=d.startLineNumber>u.endLineNumber,g=u.startLineNumber>d.endLineNumber;if(!c&&!g){l=!0;break}}if(!l){s=!1;break}}if(s)for(var _=0,v=this._trimAutoWhitespaceLines.length;_<v;_++){for(var p=this._trimAutoWhitespaceLines[_],m=this.getLineMaxColumn(p),C=!0,L=0,k=r.length;L<k;L++){var y=r[L].range,I=r[L].text;if(!(p<y.startLineNumber||p>y.endLineNumber)&&(!(p===y.startLineNumber&&y.startColumn===m&&y.isEmpty()&&I&&I.length>0&&"\n"===I.charAt(0))&&!(p===y.startLineNumber&&1===y.startColumn&&y.isEmpty()&&I&&I.length>0&&"\n"===I.charAt(I.length-1)))){C=!1;break}}if(C){var x=new b.e(p,1,p,m);t.push(new N.Qi(null,x,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n)}},{key:"_applyUndo",value:function(e,t,n,i){var r=this,s=e.map((function(e){var t=r.getPositionAt(e.newPosition),n=r.getPositionAt(e.newEnd);return{range:new b.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.oldText}}));this._applyUndoRedoEdits(s,t,!0,!1,n,i)}},{key:"_applyRedo",value:function(e,t,n,i){var r=this,s=e.map((function(e){var t=r.getPositionAt(e.oldPosition),n=r.getPositionAt(e.oldEnd);return{range:new b.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.newText}}));this._applyUndoRedoEdits(s,t,!1,!0,n,i)}},{key:"_applyUndoRedoEdits",value:function(e,t,n,i,r,s){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(s),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"applyEdits",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();var n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_doApplyEdits",value:function(e,t){var n=this,i=this._buffer.getLineCount(),s=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),a=this._buffer.getLineCount(),o=s.changes;if(this._trimAutoWhitespaceLines=s.trimAutoWhitespaceLineNumbers,0!==o.length){for(var u=0,l=o.length;u<l;u++){var h=o[u],f=(0,C.Q)(h.text),c=(0,r.Z)(f,3),g=c[0],_=c[1],v=c[2];this._tokenizationTextModelPart.acceptEdit(h.range,h.text,g,_,v),this._decorationsTree.acceptReplace(h.rangeOffset,h.rangeLength,h.text.length,h.forceMoveMarkers)}var p=[];this._increaseVersionId();for(var m=i,L=0,b=o.length;L<b;L++){var y=o[L],I=(0,C.Q)(y.text),x=(0,r.Z)(I,1)[0];this._onDidChangeDecorations.fire();for(var S=y.range.startLineNumber,N=y.range.endLineNumber,T=N-S,D=x,w=Math.min(T,D),M=D-T,A=a-m-M+S,E=A,z=A+D,O=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new k.L(E,1)),this.getOffsetAt(new k.L(z,this.getLineMaxColumn(z))),0),R=ye.gk.fromDecorations(O),B=new d.H9(R),F=function(e){var t=S+e,i=A+e;B.takeFromEndWhile((function(e){return e.lineNumber>i}));var r=B.takeFromEndWhile((function(e){return e.lineNumber===i}));p.push(new ye.rU(t,n.getLineContent(i),r))},P=w;P>=0;P--)F(P);if(w<T){var V=S+w;p.push(new ye.lN(V+1,N))}if(w<D){for(var Z=new d.H9(R),W=S+w,U=D-w,j=a-m-U+W+1,Q=[],H=[],q=function(e){var t=j+e;H[e]=n.getLineContent(t),Z.takeWhile((function(e){return e.lineNumber<t})),Q[e]=Z.takeWhile((function(e){return e.lineNumber===t}))},G=0;G<U;G++)q(G);p.push(new ye.Tx(W+1,S+D,H,Q))}m+=M}this._emitContentChangedEvent(new ye.dQ(p,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:o,eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return null===s.reverseEdits?void 0:s.reverseEdits}},{key:"undo",value:function(){return this._undoRedoService.undo(this.uri)}},{key:"canUndo",value:function(){return this._undoRedoService.canUndo(this.uri)}},{key:"redo",value:function(){return this._undoRedoService.redo(this.uri)}},{key:"canRedo",value:function(){return this._undoRedoService.canRedo(this.uri)}},{key:"handleBeforeFireDecorationsChangedEvent",value:function(e){var t=this;if(null!==e&&0!==e.size){var n=Array.from(e).map((function(e){return new ye.rU(e,t.getLineContent(e),t._getInjectedTextInLine(e))}));this._onDidChangeInjectedText.fire(new ye.D8(n))}}},{key:"changeDecorations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}},{key:"_changeDecorations",value:function(e,t){var n=this,i={addDecoration:function(t,i){return n._deltaDecorationsImpl(e,[],[{range:t,options:i}])[0]},changeDecoration:function(e,t){n._changeDecorationImpl(e,t)},changeDecorationOptions:function(e,t){n._changeDecorationOptionsImpl(e,We(t))},removeDecoration:function(t){n._deltaDecorationsImpl(e,[t],[])},deltaDecorations:function(t,i){return 0===t.length&&0===i.length?[]:n._deltaDecorationsImpl(e,t,i)}},r=null;try{r=t(i)}catch(s){(0,g.dL)(s)}return i.addDecoration=we,i.changeDecoration=we,i.changeDecorationOptions=we,i.removeDecoration=we,i.deltaDecorations=we,r}},{key:"deltaDecorations",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this._assertNotDisposed(),e||(e=[]),0===e.length&&0===t.length)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),(0,g.dL)(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}},{key:"_getTrackedRange",value:function(e){return this.getDecorationRange(e)}},{key:"_setTrackedRange",value:function(e,t,n){var i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:Ze[n]}])[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;var r=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),a=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),s,a,r),i.setOptions(Ze[n]),this._decorationsTree.insert(i),i.id}},{key:"removeAllDecorationsWithOwnerId",value:function(e){if(!this._isDisposed)for(var t=this._decorationsTree.collectNodesFromOwner(e),n=0,i=t.length;n<i;n++){var r=t[n];this._decorationsTree.delete(r),delete this._decorations[r.id]}}},{key:"getDecorationOptions",value:function(e){var t=this._decorations[e];return t?t.options:null}},{key:"getDecorationRange",value:function(e){var t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}},{key:"getLineDecorations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}},{key:"getLinesDecorations",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.getLineCount(),s=Math.min(r,Math.max(1,e)),a=Math.min(r,Math.max(1,t)),o=this.getLineMaxColumn(a),u=new b.e(s,1,a,o),l=this._getDecorationsInRange(u,n,i);return(0,d.vA)(l,this._decorationProvider.getDecorationsInRange(u,n,i)),l}},{key:"getDecorationsInRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.validateRange(e),r=this._getDecorationsInRange(i,t,n);return(0,d.vA)(r,this._decorationProvider.getDecorationsInRange(i,t,n)),r}},{key:"getOverviewRulerDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._decorationsTree.getAll(this,e,t,!0)}},{key:"getInjectedTextDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._decorationsTree.getAllInjectedText(this,e)}},{key:"_getInjectedTextInLine",value:function(e){var t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return ye.gk.fromDecorations(i).filter((function(t){return t.lineNumber===e}))}},{key:"getAllDecorations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._decorationsTree.getAll(this,e,t,!1);return n=n.concat(this._decorationProvider.getAllDecorations(e,t))}},{key:"_getDecorationsInRange",value:function(e,t,n){var i=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),r=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,i,r,t,n)}},{key:"getRangeAt",value:function(e,t){return this._buffer.getRangeAt(e,t-e)}},{key:"_changeDecorationImpl",value:function(e,t){var n=this._decorations[e];if(n){if(n.options.after){var i=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber)}if(n.options.before){var r=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.startLineNumber)}var s=this._validateRangeRelaxedNoAllocations(t),a=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),o=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),a,o,s),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(s.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(s.startLineNumber)}}},{key:"_changeDecorationOptionsImpl",value:function(e,t){var n=this._decorations[e];if(n){var i=!(!n.options.overviewRuler||!n.options.overviewRuler.color),r=!(!t.overviewRuler||!t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){var s=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(s.endLineNumber)}if(n.options.before||t.before){var a=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.startLineNumber)}i!==r?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}}},{key:"_deltaDecorationsImpl",value:function(e,t,n){for(var i=this.getVersionId(),r=t.length,s=0,a=n.length,o=0,u=new Array(a);s<r||o<a;){var l=null;if(s<r){do{l=this._decorations[t[s++]]}while(!l&&s<r);if(l){if(l.options.after){var h=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(h.endLineNumber)}if(l.options.before){var f=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(f.startLineNumber)}this._decorationsTree.delete(l),this._onDidChangeDecorations.checkAffectedAndFire(l.options)}}if(o<a){if(!l){var d=++this._lastDecorationId,c="".concat(this._instanceId,";").concat(d);l=new E.fL(c,0,0),this._decorations[c]=l}var g=n[o],_=this._validateRangeRelaxedNoAllocations(g.range),v=We(g.options),p=this._buffer.getOffsetAt(_.startLineNumber,_.startColumn),m=this._buffer.getOffsetAt(_.endLineNumber,_.endColumn);l.ownerId=e,l.reset(i,p,m,_),l.setOptions(v),l.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(_.endLineNumber),l.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(_.startLineNumber),this._onDidChangeDecorations.checkAffectedAndFire(v),this._decorationsTree.insert(l),u[o]=l.id,o++}else l&&delete this._decorations[l.id]}return u}},{key:"getLanguageId",value:function(){return this.tokenization.getLanguageId()}},{key:"setMode",value:function(e){this.tokenization.setLanguageId(e)}},{key:"getLanguageIdAtPosition",value:function(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}},{key:"getWordAtPosition",value:function(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}},{key:"getWordUntilPosition",value:function(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}},{key:"normalizePosition",value:function(e,t){return e}},{key:"getLineIndentColumn",value:function(e){return function(e){var t,n=0,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(" "!==s&&"\t"!==s)break;n++}}catch(a){r.e(a)}finally{r.f()}return n}(this.getLineContent(e))+1}}],[{key:"resolveOptions",value:function(e,t){if(t.detectIndentation){var n=(0,A.L)(e,t.tabSize,t.insertSpaces);return new N.dJ({tabSize:n.tabSize,indentSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new N.dJ({tabSize:t.tabSize,indentSize:t.indentSize,insertSpaces:t.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}}]),n}(v.JT);function Ae(e){return!(!e.options.overviewRuler||!e.options.overviewRuler.color)}function Ee(e){return!!e.options.after||!!e.options.before}Me.MODEL_SYNC_LIMIT=52428800,Me.LARGE_FILE_SIZE_THRESHOLD=20971520,Me.LARGE_FILE_LINE_COUNT_THRESHOLD=3e5,Me.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:I.D.tabSize,indentSize:I.D.indentSize,insertSpaces:I.D.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:I.D.trimAutoWhitespace,largeFileOptimizations:I.D.largeFileOptimizations,bracketPairColorizationOptions:I.D.bracketPairColorizationOptions},Me=xe([Se(4,Ie.tJ),Se(5,x.O),Se(6,S.c_)],Me);var ze=function(){function e(){(0,h.Z)(this,e),this._decorationsTree0=new E.IF,this._decorationsTree1=new E.IF,this._injectedTextDecorationsTree=new E.IF}return(0,f.Z)(e,[{key:"ensureAllNodesHaveRanges",value:function(e){this.getAll(e,0,!1,!1)}},{key:"_ensureNodesHaveRanges",value:function(e,t){var n,r=(0,i.Z)(t);try{for(r.s();!(n=r.n()).done;){var s=n.value;null===s.range&&(s.range=e.getRangeAt(s.cachedAbsoluteStart,s.cachedAbsoluteEnd))}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"getAllInInterval",value:function(e,t,n,i,r){var s=e.getVersionId(),a=this._intervalSearch(t,n,i,r,s);return this._ensureNodesHaveRanges(e,a)}},{key:"_intervalSearch",value:function(e,t,n,i,r){var s=this._decorationsTree0.intervalSearch(e,t,n,i,r),a=this._decorationsTree1.intervalSearch(e,t,n,i,r),o=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,r);return s.concat(a).concat(o)}},{key:"getInjectedTextInInterval",value:function(e,t,n,i){var r=e.getVersionId(),s=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,r);return this._ensureNodesHaveRanges(e,s).filter((function(e){return e.options.showIfCollapsed||!e.range.isEmpty()}))}},{key:"getAllInjectedText",value:function(e,t){var n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n);return this._ensureNodesHaveRanges(e,i).filter((function(e){return e.options.showIfCollapsed||!e.range.isEmpty()}))}},{key:"getAll",value:function(e,t,n,i){var r=e.getVersionId(),s=this._search(t,n,i,r);return this._ensureNodesHaveRanges(e,s)}},{key:"_search",value:function(e,t,n,i){if(n)return this._decorationsTree1.search(e,t,i);var r=this._decorationsTree0.search(e,t,i),s=this._decorationsTree1.search(e,t,i),a=this._injectedTextDecorationsTree.search(e,t,i);return r.concat(s).concat(a)}},{key:"collectNodesFromOwner",value:function(e){var t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}},{key:"collectNodesPostOrder",value:function(){var e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}},{key:"insert",value:function(e){Ee(e)?this._injectedTextDecorationsTree.insert(e):Ae(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}},{key:"delete",value:function(e){Ee(e)?this._injectedTextDecorationsTree.delete(e):Ae(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}},{key:"getNodeRange",value:function(e,t){var n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),null===t.range&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}},{key:"_resolveNode",value:function(e,t){Ee(e)?this._injectedTextDecorationsTree.resolveNode(e,t):Ae(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}},{key:"acceptReplace",value:function(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}]),e}();function Oe(e){return e.replace(/[^a-z0-9\-_]/gi," ")}var Re=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.color=t.color||"",this.darkColor=t.darkColor||""})),Be=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,h.Z)(this,n),(i=t.call(this,e))._resolvedColor=null,i.position="number"===typeof e.position?e.position:N.sh.Center,i}return(0,f.Z)(n,[{key:"getColor",value:function(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}},{key:"invalidateCachedColor",value:function(){this._resolvedColor=null}},{key:"_resolveColor",value:function(e,t){if("string"===typeof e)return e;var n=e?t.getColor(e.id):null;return n?n.toString():""}}]),n}(Re),Fe=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).position=e.position,i}return(0,f.Z)(n,[{key:"getColor",value:function(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}},{key:"invalidateCachedColor",value:function(){this._resolvedColor=void 0}},{key:"_resolveColor",value:function(e,t){return"string"===typeof e?c.Il.fromHex(e):t.getColor(e.id)}}]),n}(Re),Pe=function(){function e(t){(0,h.Z)(this,e),this.content=t.content||"",this.inlineClassName=t.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=t.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=t.attachedData||null,this.cursorStops=t.cursorStops||null}return(0,f.Z)(e,null,[{key:"from",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Ve=function(){function e(t){var n,i;(0,h.Z)(this,e),this.description=t.description,this.blockClassName=t.blockClassName?Oe(t.blockClassName):null,this.stickiness=t.stickiness||0,this.zIndex=t.zIndex||0,this.className=t.className?Oe(t.className):null,this.hoverMessage=t.hoverMessage||null,this.glyphMarginHoverMessage=t.glyphMarginHoverMessage||null,this.isWholeLine=t.isWholeLine||!1,this.showIfCollapsed=t.showIfCollapsed||!1,this.collapseOnReplaceEdit=t.collapseOnReplaceEdit||!1,this.overviewRuler=t.overviewRuler?new Be(t.overviewRuler):null,this.minimap=t.minimap?new Fe(t.minimap):null,this.glyphMarginClassName=t.glyphMarginClassName?Oe(t.glyphMarginClassName):null,this.linesDecorationsClassName=t.linesDecorationsClassName?Oe(t.linesDecorationsClassName):null,this.firstLineDecorationClassName=t.firstLineDecorationClassName?Oe(t.firstLineDecorationClassName):null,this.marginClassName=t.marginClassName?Oe(t.marginClassName):null,this.inlineClassName=t.inlineClassName?Oe(t.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=t.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=t.beforeContentClassName?Oe(t.beforeContentClassName):null,this.afterContentClassName=t.afterContentClassName?Oe(t.afterContentClassName):null,this.after=t.after?Pe.from(t.after):null,this.before=t.before?Pe.from(t.before):null,this.hideInCommentTokens=null!==(n=t.hideInCommentTokens)&&void 0!==n&&n,this.hideInStringTokens=null!==(i=t.hideInStringTokens)&&void 0!==i&&i}return(0,f.Z)(e,null,[{key:"register",value:function(t){return new e(t)}},{key:"createDynamic",value:function(t){return new e(t)}}]),e}();Ve.EMPTY=Ve.register({description:"empty"});var Ze=[Ve.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),Ve.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),Ve.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),Ve.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function We(e){return e instanceof Ve?e:Ve.createDynamic(e)}var Ue=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,h.Z)(this,n),(i=t.call(this)).handleBeforeFire=e,i._actual=i._register(new _.Q5),i.event=i._actual.event,i._affectedInjectedTextLines=null,i._deferredCnt=0,i._shouldFire=!1,i._affectsMinimap=!1,i._affectsOverviewRuler=!1,i}return(0,f.Z)(n,[{key:"beginDeferredEmit",value:function(){this._deferredCnt++}},{key:"endDeferredEmit",value:function(){var e;if(this._deferredCnt--,0===this._deferredCnt){if(this._shouldFire){this.handleBeforeFire(this._affectedInjectedTextLines);var t={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler};this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._actual.fire(t)}null===(e=this._affectedInjectedTextLines)||void 0===e||e.clear(),this._affectedInjectedTextLines=null}}},{key:"recordLineAffectedByInjectedText",value:function(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}},{key:"checkAffectedAndFire",value:function(e){this._affectsMinimap||(this._affectsMinimap=!(!e.minimap||!e.minimap.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!(!e.overviewRuler||!e.overviewRuler.color)),this._shouldFire=!0}},{key:"fire",value:function(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._shouldFire=!0}}]),n}(v.JT),je=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,h.Z)(this,n),(e=t.call(this))._fastEmitter=e._register(new _.Q5),e.fastEvent=e._fastEmitter.event,e._slowEmitter=e._register(new _.Q5),e.slowEvent=e._slowEmitter.event,e._deferredCnt=0,e._deferredEvent=null,e}return(0,f.Z)(n,[{key:"beginDeferredEmit",value:function(){this._deferredCnt++}},{key:"endDeferredEmit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._deferredCnt--,0===this._deferredCnt&&null!==this._deferredEvent){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;var t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}},{key:"fire",value:function(e){this._deferredCnt>0?this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e:(this._fastEmitter.fire(e),this._slowEmitter.fire(e))}}]),n}(v.JT)},11227:function(e,t,n){n.d(t,{U:function(){return l}});var i=n(15671),r=n(43144),s=n(11752),a=n(61120),o=n(60136),u=n(27277),l=function(e){(0,o.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments))._isDisposed=!1,e}return(0,r.Z)(n,[{key:"dispose",value:function(){(0,s.Z)((0,a.Z)(n.prototype),"dispose",this).call(this),this._isDisposed=!0}},{key:"assertNotDisposed",value:function(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}]),n}(n(10526).JT)},37926:function(e,t,n){n.d(t,{bc:function(){return h},cM:function(){return g},iE:function(){return f},pM:function(){return c},sz:function(){return _}});var i=n(15671),r=n(43144),s=n(26684),a=n(7497),o=n(10849),u=n(30788),l=n(36158),h=function(){function e(t,n,r,s){(0,i.Z)(this,e),this.searchString=t,this.isRegex=n,this.matchCase=r,this.wordSeparators=s}return(0,r.Z)(e,[{key:"parseSearchRequest",value:function(){if(""===this.searchString)return null;var e;e=this.isRegex?function(e){if(!e||0===e.length)return!1;for(var t=0,n=e.length;t<n;t++){var i=e.charCodeAt(t);if(10===i)return!0;if(92===i){if(++t>=n)break;var r=e.charCodeAt(t);if(110===r||114===r||87===r)return!0}}return!1}(this.searchString):this.searchString.indexOf("\n")>=0;var t=null;try{t=s.GF(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch(i){return null}if(!t)return null;var n=!this.isRegex&&!e;return n&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(n=this.matchCase),new l.Tx(t,this.wordSeparators?(0,a.u)(this.wordSeparators):null,n?this.searchString:null)}}]),e}();function f(e,t,n){if(!n)return new l.tk(e,null);for(var i=[],r=0,s=t.length;r<s;r++)i[r]=t[r];return new l.tk(e,i)}var d=function(){function e(t){(0,i.Z)(this,e);for(var n=[],r=0,s=0,a=t.length;s<a;s++)10===t.charCodeAt(s)&&(n[r++]=s);this._lineFeedsOffsets=n}return(0,r.Z)(e,[{key:"findLineFeedCountBeforeOffset",value:function(e){var t=this._lineFeedsOffsets,n=0,i=t.length-1;if(-1===i)return 0;if(e<=t[0])return 0;for(;n<i;){var r=n+((i-n)/2>>0);t[r]>=e?i=r-1:t[r+1]>=e?(n=r,i=r):n=r+1}return n+1}}]),e}(),c=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"findMatches",value:function(e,t,n,i,r){var s=t.parseSearchRequest();return s?s.regex.multiline?this._doFindMatchesMultiline(e,n,new _(s.wordSeparators,s.regex),i,r):this._doFindMatchesLineByLine(e,n,s,i,r):[]}},{key:"_getMultilineMatchRange",value:function(e,t,n,i,r,s){var a,o,l=0;if(a=i?t+r+(l=i.findLineFeedCountBeforeOffset(r)):t+r,i){var h=i.findLineFeedCountBeforeOffset(r+s.length)-l;o=a+s.length+h}else o=a+s.length;var f=e.getPositionAt(a),d=e.getPositionAt(o);return new u.e(f.lineNumber,f.column,d.lineNumber,d.column)}},{key:"_doFindMatchesMultiline",value:function(e,t,n,i,r){var s,a=e.getOffsetAt(t.getStartPosition()),o=e.getValueInRange(t,1),u="\r\n"===e.getEOL()?new d(o):null,l=[],h=0;for(n.reset(0);s=n.next(o);)if(l[h++]=f(this._getMultilineMatchRange(e,a,o,u,s.index,s[0]),s,i),h>=r)return l;return l}},{key:"_doFindMatchesLineByLine",value:function(e,t,n,i,r){var s=[],a=0;if(t.startLineNumber===t.endLineNumber){var o=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return a=this._findMatchesInLine(n,o,t.startLineNumber,t.startColumn-1,a,s,i,r),s}var u=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);a=this._findMatchesInLine(n,u,t.startLineNumber,t.startColumn-1,a,s,i,r);for(var l=t.startLineNumber+1;l<t.endLineNumber&&a<r;l++)a=this._findMatchesInLine(n,e.getLineContent(l),l,0,a,s,i,r);if(a<r){var h=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);a=this._findMatchesInLine(n,h,t.endLineNumber,0,a,s,i,r)}return s}},{key:"_findMatchesInLine",value:function(e,t,n,i,r,s,a,o){var h=e.wordSeparators;if(!a&&e.simpleSearch){for(var d=e.simpleSearch,c=d.length,v=t.length,p=-c;-1!==(p=t.indexOf(d,p+c));)if((!h||g(h,t,v,p,c))&&(s[r++]=new l.tk(new u.e(n,p+1+i,n,p+1+c+i),null),r>=o))return r;return r}var m,C=new _(e.wordSeparators,e.regex);C.reset(0);do{if((m=C.next(t))&&(s[r++]=f(new u.e(n,m.index+1+i,n,m.index+1+m[0].length+i),m,a),r>=o))return r}while(m);return r}},{key:"findNextMatch",value:function(e,t,n,i){var r=t.parseSearchRequest();if(!r)return null;var s=new _(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindNextMatchMultiline(e,n,s,i):this._doFindNextMatchLineByLine(e,n,s,i)}},{key:"_doFindNextMatchMultiline",value:function(e,t,n,i){var r=new o.L(t.lineNumber,1),s=e.getOffsetAt(r),a=e.getLineCount(),l=e.getValueInRange(new u.e(r.lineNumber,r.column,a,e.getLineMaxColumn(a)),1),h="\r\n"===e.getEOL()?new d(l):null;n.reset(t.column-1);var c=n.next(l);return c?f(this._getMultilineMatchRange(e,s,l,h,c.index,c[0]),c,i):1!==t.lineNumber||1!==t.column?this._doFindNextMatchMultiline(e,new o.L(1,1),n,i):null}},{key:"_doFindNextMatchLineByLine",value:function(e,t,n,i){var r=e.getLineCount(),s=t.lineNumber,a=e.getLineContent(s),o=this._findFirstMatchInLine(n,a,s,t.column,i);if(o)return o;for(var u=1;u<=r;u++){var l=(s+u-1)%r,h=e.getLineContent(l+1),f=this._findFirstMatchInLine(n,h,l+1,1,i);if(f)return f}return null}},{key:"_findFirstMatchInLine",value:function(e,t,n,i,r){e.reset(i-1);var s=e.next(t);return s?f(new u.e(n,s.index+1,n,s.index+1+s[0].length),s,r):null}},{key:"findPreviousMatch",value:function(e,t,n,i){var r=t.parseSearchRequest();if(!r)return null;var s=new _(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindPreviousMatchMultiline(e,n,s,i):this._doFindPreviousMatchLineByLine(e,n,s,i)}},{key:"_doFindPreviousMatchMultiline",value:function(e,t,n,i){var r=this._doFindMatchesMultiline(e,new u.e(1,1,t.lineNumber,t.column),n,i,9990);if(r.length>0)return r[r.length-1];var s=e.getLineCount();return t.lineNumber!==s||t.column!==e.getLineMaxColumn(s)?this._doFindPreviousMatchMultiline(e,new o.L(s,e.getLineMaxColumn(s)),n,i):null}},{key:"_doFindPreviousMatchLineByLine",value:function(e,t,n,i){var r=e.getLineCount(),s=t.lineNumber,a=e.getLineContent(s).substring(0,t.column-1),o=this._findLastMatchInLine(n,a,s,i);if(o)return o;for(var u=1;u<=r;u++){var l=(r+s-u-1)%r,h=e.getLineContent(l+1),f=this._findLastMatchInLine(n,h,l+1,i);if(f)return f}return null}},{key:"_findLastMatchInLine",value:function(e,t,n,i){var r,s=null;for(e.reset(0);r=e.next(t);)s=f(new u.e(n,r.index+1,n,r.index+1+r[0].length),r,i);return s}}]),e}();function g(e,t,n,i,r){return function(e,t,n,i,r){if(0===i)return!0;var s=t.charCodeAt(i-1);if(0!==e.get(s))return!0;if(13===s||10===s)return!0;if(r>0){var a=t.charCodeAt(i);if(0!==e.get(a))return!0}return!1}(e,t,0,i,r)&&function(e,t,n,i,r){if(i+r===n)return!0;var s=t.charCodeAt(i+r);if(0!==e.get(s))return!0;if(13===s||10===s)return!0;if(r>0){var a=t.charCodeAt(i+r-1);if(0!==e.get(a))return!0}return!1}(e,t,n,i,r)}var _=function(){function e(t,n){(0,i.Z)(this,e),this._wordSeparators=t,this._searchRegex=n,this._prevMatchStartIndex=-1,this._prevMatchLength=0}return(0,r.Z)(e,[{key:"reset",value:function(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}},{key:"next",value:function(e){var t,n=e.length;do{if(this._prevMatchStartIndex+this._prevMatchLength===n)return null;if(!(t=this._searchRegex.exec(e)))return null;var i=t.index,r=t[0].length;if(i===this._prevMatchStartIndex&&r===this._prevMatchLength){if(0===r){s.ZH(e,n,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=i,this._prevMatchLength=r,!this._wordSeparators||g(this._wordSeparators,e,n,i,r))return t}while(t);return null}}]),e}()},59921:function(e,t,n){function i(e,t){for(var n=0,i=0,r=e.length;i<r;){var s=e.charCodeAt(i);if(32===s)n++;else{if(9!==s)break;n=n-n%t+t}i++}return i===r?-1:n}n.d(t,{q:function(){return i}})}}]);
//# sourceMappingURL=monaco-editor-vendor.1a061fac.e5355c21.js.map